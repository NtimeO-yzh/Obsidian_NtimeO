# L01: 引论

# L02: 器件与互连线
## 壹---器件
### 一、二极管
#### 1.二极管简介
存在一个内建电势：$\phi_{0}=\phi_{T}\ln\biggl[\frac{N_{A}N_{D}}{n_{t}^{2}}\biggr]$

- 热电势$\phi_{T}=\frac{kT}{q}=26\mathrm{mV}\quad(300\mathrm{K}\mathrm{时})$
- $N_A、N_D$分别是P型材料和N型材料的掺杂浓度
- $n_t$为半导体纯样品的固有载流子浓度，300K是Si的$n_t$值约为$1.5\times10^{10}{cm}^{-3}$

#### 2.静态特性

##### （1） 理想的二极管方程

![[Pasted image 20231027150802.png#center|]]
描述二极管的电流: $I_D=I_s(e^{V_D/\phi_T}-1)$. ^1

- $I_s$二极管的饱和电流，是一个常数值。与二极管的面积成正比，并其余掺杂水平和中性区的宽度有关没大多数情况下是根据经验确定的。对于一个典型的硅pn结，饱和电流通常在$10^{-17}A/{{\mu}m}^2$。实际的反向电流（漏电流）要比这个大三个数量级。
- $\phi_T$是热电势，室温下等于**26mV。**
##### （2） 人工分析模型

固定压降0.6～0.8V。![[Pasted image 20231027150848.png|inlR|400]]






#### 3.动态特性

这里讲的是对于偏置情况改变的响应，决定了器件的最大工作速度。在二极管之中，动态特性很大程度上取决于空间电荷区能够移动的多快。而在数字电路之中，二极管都是反向偏置的。

##### （1）耗尽区电容

理想模型之中，耗尽区没有可移动的载流子，耗尽区的电荷取决于不能移动的施主和受主离子。正偏置的时候，势垒降低，耗尽区变窄，电荷变少。反向偏置就是反之。在宏观上，就像是一个电容。

1. 耗尽区电荷（正向偏置）
   
    $$ Q_{j}=A_{D}\sqrt{(2\varepsilon_{si}q\frac{N_{A}N_{D}}{N_{A}+N_{D}})(\phi_{0}-V_{D})} $$
    
2. 耗尽区宽度
   
    $$ W_{j}=W_{2}-W_{1}=\sqrt{\Big(\frac{2\varepsilon_{si}N_{A}+N_{D}}{q}\frac{N_{A}+N_{D}}{N_{A}N_{D}}\Big)(\phi_{0}-V_{D})} $$
    
3. 最大电场
   
    $$ E_{j}=\sqrt{\Big(\frac{2q}{\varepsilon_{si}N_{A}+N_{D}}\Big)(\phi_{0}-V_{D})} $$
    
    - $\varepsilon_{si}$是硅的介电常数，大概是真空介电常数的11.7倍，约为$1.053\times10^{-10} F/m$。
4. 等效电容
    $$ \begin{aligned}C_{j}&=\frac{dQ_{j}}{dV_{D}}=A_{D}\sqrt{\left(\frac{\varepsilon_{si}q}{2}\frac{N_{A}N_{D}}{N_{A}+N_{D}}\right)(\phi_{0}-V_{D})^{-1}}\\&=\frac{C_{j0}}{\sqrt{1-V_{D}/\phi_{0}}}\end{aligned} $$
    
    其中$$C_{j0}=A_{D}\sqrt{\left(\frac{\varepsilon_{si}q}{2}\frac{N_{A}N_{D}}{N_{A}+N_{D}}\right)\phi_{0}^{-1}}$$
##### （2）大信号耗尽区电容

3.8图告诉我们啊：电容取决于外加偏置电压。在数字电路之中，工作电压的变化范围很大很快，希望用一个**等效的线性电容$C_{eq}$来替代和电压有关的非线性电容$C_{j0}$**。

- 定义$C_{eq}$：对于一个给定的电压摆幅，$V_{high}$→$V_{low}$，电荷的改变量和非线性模型一样滴。====

因此有了

$$ C_{eq}=\frac{\Delta Q_{j}}{\Delta V_{D}}=\frac{Q_{j}(V_{high})-Q_{j}(V_{tow})}{V_{high}-V_{low}}=K_{eq}C_{j0} $$

其中$K_{eq}$为

$$ K_{eq}=\frac{-\phi_{0}^{m}}{(V_{high}-V_{low})(1-m)}[(\phi_{0}-V_{high})^{1-m}-(\phi_{0}-V_{low})^{1-m}] $$

#### 4.实际二极管的二次效应

- 电流比理想的要小：中性区总会有一些电压降，所以外加偏置电压不会全部出现在结两端。（中性区的电阻比较小，1～100欧）。模拟的时候，n和p区接触点上串联一个电阻。
- 反向偏置电压太大的时候会出现雪崩击穿，可以恢复，但是不要一直击穿。（高掺杂的情况下会出现齐纳击穿） 
- ![[Pasted image 20231027151030.png|500]]
- 温度的影响:
	- 1出现在电流方程指数项上的热电势$\phi_t$与温度成线性关系。[[#^1]]可以观察出,$\phi_t$增加使电流下降。
	- 2.饱和电流$I_s$也与温度有关，因为热平衡时的载流子浓度随温度的升高面增加。理论上，<font color="#ff0000">温度上升5°C 跑和电流约增加一倍</font>。实验测得的反向电流每 8°C增加一倍。
	这一双重关系对数字电路的工作有很大影响．首先，温度上升, 电流（从而功耗）会显著加大。例如
1. 对于一个在300°K 时0.7V的正偏置，温度每上升1°C电流约增加6%，每上升12°C 电流会翻一倍。当电流值固定时，温度每上开1°C 二极管的电压V，下降2mV
2. 第二，集成电路高度依赖于把反向偏置的二极管作为**绝缘体**来用。温度的升高会引起漏电流的增加，因而降低绝缘的质量。
(功耗和绝缘质量)
#### 5.二极管的 SPICE 模型
![[Pasted image 20231028000426.png|300]]
##### (1)稳态特性
稳态特性⽤⼀个⾮线性的电流源$I_D$来模拟，它对理想的⼆极管公式做了⼀些修改：$$I_{D}=I_{S}(\mathrm{e}^{V_{D}/n\cdot\phi_{T}}-1)$$
- **n称为发射系数**，对最普通的⼆极管它等于1，但对另⼀些它可以⽐1 ⼤些。
- **电阻R**,⽤来模拟结两边中性区的串联电阻。在电流较⼤时，该电阻使⼆极管的内部电压 V不同于外加电压，因此所产⽣的电流⽐从⼀个理想⼆极管公式中预期的电流要低。
##### (2)动态特性
![[support/img/Pasted image 20231028002214.png|500]]
动态特性使用非线性电容$C_D$来模拟,它同时考虑了⼆极管中两个不同的**电荷存储效 应**：
1. 空间(或耗尽区)电荷
2. <span style="background:#affad1">过剩的少⼦电荷(只在正向偏置条件下)</span>
非线性电容$C_D$的定义如下:$$C_{D}=\frac{C_{j0}}{(1-V_{D}/\phi_{0})^{m}}+\frac{\tau_{T}I_{S}}{\phi_{T}}\mathrm{e}^{V_{D}/n\phi_{T}}$$

### 二、MOSFET

从数字设计⾓度来看，它的主要优点是**作为⼀个开关**它有良好的性能以及**引起的寄⽣效应很⼩**。并且制造工艺简单,有高密度的集成。
- 叙述步骤:概述-->静态-->动态-->spice
#### 1.MOS 晶体管简介
![[support/img/Pasted image 20231028132354.png|200]]
MOSFET 是一个四端器件. 在 G 的电压决定了 D S 之间的电流. Body 是第四个端口,作用相对小一些.
- 分类:
	1. PMOS:n 衬底和 p 的源区和漏区
	2. NMOS:p 衬底和 n 的源区和漏区
	- 注意 PN 结的<span style="background:#affad1">电流是电子和空穴构成的</span>,但是 MOS 只能由一种构成.
#### 2.静态下的 MOSFET
集中讨论 NMOS
##### (1)阈值电压
1. **$V_{GS}=0$, B G S 均接地.**
	此时漏和源由<font color="#c00000">背靠背的pn 结(衬底-源及衬底-漏)</font>所连。在上述情况下，两个结均具有0v的偏置，因此可以被考虑为断开，这导致了漏和源之间极高的电阻。
2. $V_{GS}>0$,  **B S 均接地.**
   此时G 和 B 相当于电容器的两个极板. SiO2 为电介质. 由于栅压＞0,因此正电荷下去,负电荷上来.<span style="background:#affad1">起初,负电荷下去是通过排斥可移动的空穴形成的.</span>于是在 G 下面形成了一个<font color="#c00000">耗尽区</font>,<span style="background:#affad1">它与 pn 结中的耗尽区十分像</span>.
   其宽度和储存的电荷分别为$W_{d}=\sqrt{\frac{2\varepsilon_{si}\phi}{qN_{A}}}$, ${Q}_{d}=-\sqrt{2qN_{A}\varepsilon_{si}\phi}$. 
	其中,$N_A$ 为衬底掺杂,$\phi$为耗尽层上的电压,也就是 sio2 和 si 边界上的电势
	- **<font color="#ffc000">临界情况</font>**: 电压等于两倍费米势$\phi_F$的时候.此时,发生强反型现象.$p$型衬底的(<u>衬底的费米势,注意表述</u>)的费米势为:$$\phi_{F}=-\phi_{T}\mathbf{ln}\Big(\frac{N_{A}}{n_{i}}\Big)$$其典型值为$0.3V$.
	- 进一步提高$V_G$提高的是反型层中的电子数量,而不是耗尽层的宽度.如何做到的呢?<font color="#ff0000">从掺杂的 D 和 S 区拽出来的.</font>拽的足够多的时候,就形成了n 型导电沟道.
	当存在反型层时,耗尽区的电荷是固定:$$Q_{B0}=-\sqrt{2qN_A\epsilon_{si}|2\phi_F|}$$
3. $V_{GS}>0,V_{SB}>0$,  **B S 均接地.**
	它使强反型所要求的表面电势增加并且变为$|2\phi_{F}+V_{SB}|$,对应的耗尽区的电荷变为$$Q_{B}=-\sqrt{2qN_{A}\varepsilon_{si}(\left|(-2)\phi_{F}+V_{SB}\right|)}$$<font color="#ff0000">我们称发生强反型时对应的</font>$V_{GS}$<font color="#ff0000">的值为阈值电压</font>$V_T$.
	<span style="background:#d3f8b6">从前⾯的讨论中可以清楚地看到，源-体电压$V_s$对阈值也有影响。</span>与其依赖于⼀个复杂的(并且多半也是不精确的)阈值解析表达式，还不如依靠⼀个经验参数$V_{T0}$，它是$V_{SB}=0$时的國值电压，并且主要与制造⼯艺有关。于是在不同体偏置条件下的阈值电压可由下式确定：$$V_{T}=V_{T0}+\gamma(\sqrt{|(-2)\phi_{F}+V_{SB}|}-\sqrt{|2\phi_{F}|})$$
	- $\gamma$<font color="#ff0000">为衬底偏执效应系数</font>
	以下$\phi_F=0.6V$, $\gamma = 0.4 V^{0.5}$,注意$V_{SB}$<span style="background:#d3f8b6">必须大于 0.6,否则二极管SB就会正偏.</span>
	![[support/img/Pasted image 20231030085448.png|300]]
##### (2)电阻工作区
4. $V_{GS}>V_T, V_{DS}>0$但不算太大,B接地,S电压由$V_T$来表征
	- 目标:求 $I_D(V_{GS}, V_{DS})$
	- 推导过程
	1. 设在沿沟道长度方向的$x$处,相对于沟道起点 S 的电压为$V{(x)}$. 因此栅极相对于这一$x$点的电压差为$V_{GS}-V(x)$.假设整个沟道的$V_{GS}-V(x)$都超过了阈值电压,那么在$x$点处感应出的每单位面积的沟道电荷可以用一下方法计算$$Q_{i}(x)=-C_{ox}[V_{GS}-V(x)-V_{T}] \tag1$$
	 $C_{ox}$为栅氧的单位面积电容$C_{ox}=\frac{\varepsilon_{ox}}{t_{ox}}$ , 其中e${\mathcal E}_{ox}=3.97\times{\mathcal E}_{o}=3.5\times10^{-11}\mathrm{F/m}$为氧化层的介电常数,$t_{ox}$为氧化层厚度. ^8c3f2e
> [!note] 一些注意的点
> 1. 这里的**每单位面积的沟道电荷**是指的从上往下看,每单位面积的电荷,就是已经在厚度方向上做乘法了. 要不就是说每单位体积内的了. 
> 2. 在现代工艺之中,$t_{ox}$的值大概是 10nm,很容易被击穿.
> 3. 对于一个 5nm 厚的氧化层,相当于一个 $7fF/μm^2$ 

![[support/img/Pasted image 20231030172718.png|300]]
	2. 在微观的意义上计算电流.$$I_{D}=-\upsilon_{n}(x)\cdot Q_{i}(x)\cdot W\tag2$$
	其中, $W$是垂直于电流方向(垂直于直面往里)的**沟道宽度**. 由于$Q_{i}(x)$和$W$的乘积就代表了垂直于l(或者说电流)方向上的总面积的电荷, 之后再与$\upsilon_{n}(x)$相乘就是电流了,在整过道上就是一个常数了.(<span style="background:#d3f8b6">课本上说的:由于电荷守恒，所以它在沟道的全长上是⼀个常数。</span>)
> [!question]
> 不懂这里的常数是啥意思,你要说电流在整个沟道上的分布是一个常数还是电流与 L 的乘积是一个常数啊,我感觉后者是对的,但没啥用啊

   其中电子的速度通过一个称为**迁移率**的参数$μ_n$与电场相关和晶体结构相关,一般简化为$$\upsilon_{n}=-\mu_{n}\xi(x)=\mu_{n}\frac{\mathrm{d}V}{\mathrm{d}x}\tag3$$
	联立以上的式子(1)(2)(3)就可以得到$$I_{D}\mathrm{d}x=\mu_{n}C_{ox}W(V_{GS}-V-V_{T})\mathrm{d}V$$在整个沟道 L 上积分得到晶体管的电压和电流关系,即$$I_{D}=k_{n}^{\prime}\frac{W}{L}\bigg[(V_{GS}-V_{T})V_{DS}-\frac{V_{DS}}{2}^{2}\bigg]=k_{n}\bigg[(V_{GS}-V_{T})V_{DS}-\frac{V_{DS}}{2}^{2}\bigg]\tag4$$
	其中,$k_{n}^{\prime}$称为工艺跨导参数, $k_{n}^{\prime}=\mu_{n}C_{ox}=\frac{\mu_{n}\varepsilon_{ox}}{t_{ox}}$
		$k_{n}^{\prime}\cdot W/L$ 为这一期间的增益因子$k_n$.
	注意,当$V_{DS}$较小的时候, $I_D$和$V_{DS}$成线性关系.因此称为<font color="#ff0000">电阻区或者线性区</font>.它的⼀个主要特点是它在源区 和漏区之间表现为**⼀条连续的导电沟道**。
> [!note]
> 式(4）中的参数以和L代表晶体管的有效沟宽和沟长。这些值与版因上所画的尺⼨不同，这是由于源区与漏区的横向扩散作⽤(对L)和隔离场氧被侵独的影响(对W）等造成的。 在本书的其余部分，W 和 L将总是代表有效尺⼨，⽽下标d则⽤来说明是所画的尺⼨。

##### (3)饱和区
5. $V_{GS}>V_T, V_{DS}>0$且继续上升,B接地,S电压由$V_T$来表征
   当漏源电压值进⼀步提⾼时，<font color="#ff0000">沿全⻓沟道电压都⼤于阈值的假设就不再成⽴，</font>这通常发⽣在当$V_{GS}-V(x)<V_{T}$时。。在这⼀点上，**被感应的电荷为零**，⽽导电沟道消失或者说它已被**夹断**(pinch off）。显然,由公式(1)为使这⼀现象发⽣，主要是在漏区要满⾜夹断条件，也就是：$$V_{GS}-V_{DS}\leqslant V_{T}$$![[support/img/Pasted image 20231031143357.png|400]]
   > [!summary] 理解夹断
> 	这里的$V_{DS}$就是公式1里边的$V(x)$. 形成反型层的第二步不是在重掺杂的区域拽出来电子嘛,你 D 的电压提高了之后不就拽不出来的吗.
> 	那这一步主要影响的是哪个公式呢,是(4).因为不可以在全长 L 上对式子进行积分了.

<font color="#ff0000">由于在感应形成的沟道上的电压差(从夹断点到源)保持固定在</font>$V_{GS}-V_T$,上，<font color="#ff0000">结果使电流保持为常数(或饱和）.</font>⽤$V_{GS}-V_T$,代 替式（4)中的$V_{DS}$，得到了饱和模式时的漏极电流$$I_{D}=\frac{k_{n}}{2}\frac{W}{L}(V_{GS}-V_{T})^{2}\tag5$$注意，就⼀阶近似⽽⾔，漏电流不再是$V_{DS}$的两数。还要注意的是，漏电流与控制电压$V_{GS}$之间存在平⽅关系
> [!question] 电压差一定怎么得到的电流一定?
> 我只能理解说,电压$V_{DS}$升高了之后,虽然电压(推动力)变大了,但是整个沟道里边的电子不会增加了(感觉甚至减少了),所以电流不会增加特别多.但要是直接说夹断点的 V(x)是不变的,所以电流不变,那表示难以理解.V(x)不变的时候,总电荷不变?总电荷不变 $V_{DS}$增加的话那也应该电流加大啊.
> 
###### A:沟道⻓度调制
饱和模式下晶体管的作⽤像⼀个理想的电流源——在D与S间的电流相对于电压$V_{DS}$是恒定的.但这并不完全正确。导电沟道的有效⻓度实际上由所加的$V_{DS}$调制：增加$V_{DS}$将使漏结的耗尽区加⼤，从⽽缩短了有效沟道的⻓度。正如从(5)中可以看到的，当⻓度⼯滅⼩时电流会增加。因此关于 MOS 管电流的⼀个更精确的描述为:$$I_{D}=I_{D}{}^{\prime}(1+\lambda V_{DS})$$
其中,$I_{D}{}^{\prime}$是(5)推导出的表达式.$\lambda$是沟长调制系数,是一个经验参数.
	⼀般来说$\lambda$与沟长成反⽐。在沟长较短的晶体管中，漏结耗尽区占了沟道的较⼤部分，沟道的调制效应也更加显著。<span style="background:#affad1">因此在需要⾼阻抗的电沆源时 建议采⽤⻓沟道晶体管。</span>
###### B:速度饱和假设
沟道⾮常短的品体管（称为**短沟器件**）的特性与上⾯介绍的电阻⼯作区和饱和区的模型有很 ⼤的不同。这⼀差别的主要原因就是**速度饱和效应**。**(3)式**表明载流⼦的速度正⽐于电场，这⼀关系与电场强度值的⼤⼩⽆关.换⾔之，<font color="#ff0000">载流⼦的迁移率是⼀个常数</font>。然⽽在（⽔平⽅向）电场强度很⾼的情况下，载流⼦不再符合这⼀线性模型。当沿沟道的电场达到某临界值$\xi_c$.时，<font color="#ff0000">载流⼦的速度将由于<font color="#ff0000">散射效应</font>(即载流⼦间的碰撞)⽽趋于饱和</font>。意思就是:电场(推动力)再怎么增加,但由于碰撞散射,速度不增加了
![[support/img/Pasted image 20231031105702.png|300]]
<span style="background:#affad1">电⼦和空⽳的饱和速度⼤致相同，</span>即$10^5m/s$.速度饱和发⽣时的临界电场强度,取决于:**摻杂浓度和外加的垂直电场强度**。对于电⼦，临界电场在 1~5 V/pm 之问。<span style="background:#affad1">在n型硅中的空⽳需要稍⾼⼀些的电场才能达到饱和，因此在 PMOS 晶体管中速度饱和效应不太显著。</span>
> [!question] 电子和空穴还不一样?

**a:假设**
图3.17 所画出的速度与电场的关系可以⽤带有条件的下式来⼤致近似：$$v=\begin{cases}\frac{\mu_{n}\xi}{1+\xi/\xi_{c}},&\xi\leqslant\xi_{c}\\v_{sat},&\xi\geqslant\xi_{c}\end{cases}$$
为了使这两个区域间连续，要求$$\xi_{_{c}}=2v_{_{sat}}/\mu_{_{n}}$$
**b:电阻工作区**
如果⽤修正后的速度公式重新对式(1)和式(2)求值，就得到了在*电阻⼯作区*漏极电流的修正式：$$\begin{aligned}I_D&=\frac{\mu_nC_{ox}}{1+(V_{DS}/\xi_cL)}\Big[(V_{GS}-V_T)V_{DS}-\frac{V_{DS}}{2}\Big]\\\\&=\mu_nC_{ox}\Big[(V_{GS}-V_T)V_{DS}-\frac{{V_{DS}}^2}{2}\Big]\kappa(V_{DS})\end{aligned}\tag6$$
- 其中,$\kappa(V_{DS})$考虑速度饱和的程度,其定义为: $$\kappa(V)=\frac{1}{1+(V/\xi_{c}L)}\tag7$$.
	- $V_{DS}/L$可以被解释为在沟道中的平均电场。
	- 在长沟器件(L值较⼤）或$V_{DS}$值较⼩的情况下，$\kappa$接近1，于是式(6)就简化为通常情况下*电阻⼯作模式*的电流公式。对于短沟器件，$\kappa$⼩于1，这意味着所产⽣的电流将⼩于通常所预期的值。
	**c:速度饱和**
	*当增加漏源电压到$V_{DSAT}$时*，沟道中的电场最终达到了临界值$\xi_{_{c}}$，于是在漏端的载流⼦出现速度饱和。首先计算临界时的电流$$\begin{aligned}I_{DSAT}&=\upsilon_{sat}C_{ox}W(V_{GT}-V_{DSAT})\\\\&=\kappa(V_{DSAT})\mu_{n}C_{ox}\frac{W}{L}\biggl[V_{GT}V_{DSAT}-\frac{{V_{DSAT}}^2}{2}\biggr]\end{aligned}\tag8$$式子中$V_{GT}=V_{GS}-V_T$,在合并有关项并简化之后得到电压$$V_{DSAT}=\kappa(V_{GT})V_{GT}\tag9$$进⼀步增加DS电压并,载流子速度不再增加,因此不能产⽣更多的电流(就⼀阶近似⽽⾔)，即晶体管的电流饱和在$I_{DSAT}$上。
> [!note] 推导见 Page1~2


> [!summary] 我说几个点
> 1. 这里速度饱和是由于载流子速度达到了一定值呀,之前长沟是因为沟道夹断了.所以你不能用$V_{GT}$代替$V_{DS}$
> 2. 公式(9)并没有什么现实的意义,就是可以量化的看一下
> 3. 这里的思路是,先推导电流,之后通过(9)看一下$V_{DSAT}$和$V_{GT}$的关系.因为这个$V_{GT}$就是之前长沟饱和的$V_{DS}$,所以有了以下课本上的话

![[support/img/Pasted image 20231031115028.png]]
![[support/img/Pasted image 20231031115400.png|inlR|200]]以上这些公式都忽略了⼀个事实，即进⼀步增加$V_{DS}$会使更⼤部分的沟道变成速度饱和。从建⽴模型的⻆度来看，它仿佛就像是有效沟道长度随着$V_{DS}$的增加⽽缩短，其效果⾮常类似于沟⻓调制.所引起的电流增加可以很容易地通过引⼈另⼀乘数项$(1+\lambda\times V_{DS})$来考虑.



**d:手工分析**
简化假设
1. 速度饱和即刻发⽣在$\xi_{_{c}}$$$\upsilon=\begin{cases}\mu_n\xi,&\xi\le\xi_c\\\upsilon_{sat}=\mu_n\xi_c,&\xi\geqslant\xi_c\end{cases}$$
2. 达到临界电场且出;现饱和速度时的漏源电压$V_{DSAT}$是⼀个常数，并可以近似为$$V_{DSAT}=L\xi_{c}=\frac{L\upsilon_{sat}}{\mu_{n}}$$
<font color="#ff0000">可以得出这⼀假设对于较⼤的</font>$V_{GT}$<font color="#ff0000">值是合理的</font>.在这些条件下，电阻⼯作区的电流式与⻓沟模型相⽐保持不变。⼀旦达到$V_{DSAT}$，电流就即刻饱和。此时的$I_{DSAT}$值可以通过把饱和电压代⼈电阻区的电流式得到：$$\begin{aligned}
I_{DSAT}& =I_{D}(V_{DS}=V_{DSAT})  \\
&=\mu_{n}C_{ox}\frac{W}{L}\Big((V_{GS}-V_{T})V_{DSAT}-\frac{V_{DSAT}^{2}}{2}\Big) \\
&=\upsilon_{sat}C_{ox}W\biggl(V_{GS}-V_{T}-\frac{V_{DSAT}}{2}\biggr)
\end{aligned}$$
这⼀模型完全是⼀阶近似并且是经验模型。这<span style="background:#affad1">种简化的速度模型在线性区和速度饱和区之间的过渡区上会引起明显的偏差。</span>
![[support/img/Pasted image 20231031125457.png#center|400]]
![[support/img/Pasted image 20231031125611.png#center|400]]

---

省略了课本上的:漏极电流与电压的关系图、亚阈值情形

---
##### (4)手工分析模型
###### A 第一次简化
这⼀模型把晶体管表示成⼀个电流源(⻅图3.23)。它的值由该图给出。因3.24表示了这个通⽤模型如何把品体管的整个⼯作空间划分成三个区城：线性区、速度 饱和区 及饱和区，并且标明了在这些区域之间的边界。⽐较重要的是，模型应当在**最有关的区城内匹配最好**。<span style="background:#affad1">这在数字电路中就是</span>$V_{DS}$和$V_{GS}$<span style="background:#affad1">较⾼的区域</span>.
![[support/img/Pasted image 20231031131221.png#center|]]
![[support/img/Pasted image 20231031131350.png|300]]
这个图一定要知道那个*min*的式子和为啥*饱和区和速度饱和区能在一个图上*.$V_{DSAT}和 V_{GT}$哪个小就说明了到底是长沟还是短沟,只有前者小的时候,或者说 $V_{GS}$大的时候,才会有速度饱和,否则就没有.(可以想 GS 之间的电压会提高载流子浓度,从而容易发生速度饱和,太低的时候就没有,饱和就是普通饱和.)DS 之间电压的取值说明了到底是不是线性区,至于是什么饱和,就看那俩的比较值了.所以图中分成了三个区域.
###### B第二次简化
它以在⼤多数数宇设计中的基本假设作为基础，即晶体管只不过是⼀个开关，它有⽆穷⼤的“断开”电阻和有限的“导通”电阻（⻅图3.26）。
![[support/img/Pasted image 20231031134411.png|300]]
这⼀模型的主要问题是$R_{on}$是时变的、⾮线性的并取决于晶体管的⼯作点。对此⼀个合理的⽅法是采⽤在所关⼼ 的⼯作区城上电阻的平均值，或过⾄更为简单地，采⽤在瞬态过程的起点和终点处两个电阻的平均值。后⼀个假设能很好地成⽴，只要电阻在进⾏平均的问隔范围内并不出现任何⾼度的⾮线性。与此相应，有：$$\begin{aligned}
\text{Req}& =\mathrm{average}_{t=t_{1}\cdots t_{2}}(R_{on}(t))=\frac{1}{t_{2}-t_{1}}\int_{t_{1}}^{t_{2}}R_{on}(t)\mathrm{d}t=\frac{1}{t_{2}-t_{1}}\int_{t_{1}}^{t_{2}}\frac{V_{DS}(t)}{I_{D}(t)}\mathrm{d}t  \\
&\approx\frac{1}{2}(R_{on}(t_{1})+R_{on}(t_{2}))
\end{aligned}$$

##### (5)等效电阻
这里一定是晶体管*开关模型*的等效电阻. 
#### 3.动态特性
一个 MOSFET 管的动态响应只取决于它*充放电的这个器件的本征寄生电容*和互连线及负载引起的*额外电容*所需要的时间. 其中本证电容主要有三个来源:
1. 基本的 MOS 结构
2. 沟道电荷
3. 漏源反向偏置 pn 结的耗尽区
除了结构带内容之外的两个,都是非线性的,并且与外加的电压相关
##### (1)结构电容
在线性电阻区已经定义了单位面积的栅氧电容$C_{ox}$[[#^8c3f2e]], 这个电容的总值称为栅电容$C_g$, 其可以分为两个部分. 他一部分会影响沟道电荷, 另一部分完全来自于晶体管的拓扑结构.  
![[support/img/Pasted image 20231106133426.png|300]]
在理想状态下,D和 S 扩散应该恰好终止在栅氧的边上. 现实中,D 和 S 都会往栅氧下面延伸一小段距离, 这称为**横向扩散**. 因此晶体管的有效沟长比实际沟长短一个$\Delta L=2x_{d}$的距离, 这也正是引起了 G 和 S 与 G 和 D 之间的寄生电容, 称为**覆盖电容**.这个电容是线性的并具有固定的值:$$C_{GSO}=C_{GDO}=C_{ox}x_{d}W=C_{o}W$$
由于$x_d$是由⼯艺决定的，习惯上把它与每单位⾯积的栅氧电容$C_{ox}$相乘,得到的是每单位晶体管宽度的覆盖电容$C_o$（更具体地说为 $C_{gso}$和 $C_{gdo}$）。
> [!question] 这里对应存储的电荷是什么?
> 
##### (2)沟道电容
G 到沟道的电容$C_{GC}$是最重要的MOS寄生电容部分,它的**大小**和它在$C_{GCS}、C_{GCD}$和$C_{GCB}$(分别为栅⾄源、栅⾄漏和栅⾄体的电容)这三部分之间的**划分**取决于*⼯作区域和端⼝电压*。这种会产⽣不同分布的情况可以⽤图3.30的简图来解释。
1. 截⽌区域(a），没有任何沟道存在，所以,总电容$C_{GC}$出现在栅和体之间。
2. 电阻区(b), 形成了⼀个反型层，它的作⽤像源与漏之间的⼀个导体。结果$C_{GCB}=0$, 因为体电极与栅之间被沟道所屏蔽。对称性使这⼀电容在源与漏之问平均分布。
3. 饱和区(c), 沟道被夹断。栅与漏之间的电容近似为0，⽽且栅⾄体电容也为0。因此所有的电容是在栅与源之间的。
![[support/img/Pasted image 20231106135846.png]]
![[support/img/Pasted image 20231106165935.png]]
![[support/img/Pasted image 20231106173420.png]]
**疑问**
1. 没有沟道存在的时候怎么计算出的沟道电容,因为不存储电子啊?  
   - 肯定是存储的,只不过是存储在耗尽区之中了.此时就是 G 和 B 共同组成的等效电容, 随着 $V_{GS}$的增加, 耗尽层的厚度增加,电荷不知道怎么变,反正电容就是减小了
2. G 下的耗尽区到底是栅氧之下的还是G 下的?  
   - 肯定是栅氧之下的
3. 如果是栅氧之下的话,那存储的电荷还有意义吗?  
   - 肯定有意义啊
4. 导电沟道是一下子形成的吗?  
   - 是的!
5. 为什么导通就是平分?
   - 因为电荷的分布是平分的
6. 屏蔽的意思是什么?
   - 还不是很清楚,但大概的意思就是慢慢的电容都是由 S 和 D 提供的了,B 的作用很小了,来自B 的电荷几乎没有了
7. 导电沟道在这里究竟是什么作用才导致的 G 与 S、D 之间的电容这样分布?
   - 就是看来自于谁的电荷多
8. 为什么是 2/3?
	- 因为是一个论文中推导出来的



##### (3)结电容
> [!info] 首先回顾一下 pn 结电容
> 结电容为什么是势垒电容和扩散电容之和：
> 1. 势垒电容：当二极管截止时候，在PN结处由于扩散会天然形成电荷的富集(耗尽区)，此时的电容就是势垒电容；  
  2. 扩散电容：二极管从截止到导通需要一个“饱和”的过程，就是说载流子从密集在PN结附近到扩散到全部半导体，这个过程就是产生了扩散电容。
> 二极管从截止到导通，必须要经历这个过程，扩散电容的大小和P型半导体的掺杂浓度有关，和P型半导体的厚度有关。这过程也叫做二极管的反向恢复。

后⼀部分电容是由反向偏置的**源⼀体**和**漏-体**之间的pn 结引起的。耗尽区电容是⾮线性的，并且正如前⾯讨论过的，当反向偏置提⾼时它会减⼩。为了理解结电容(常称为**扩散电容**)的构成，我们看⼀下源(漏）区及其周围的情形。图3.33 显示源区pn结是由两部分组成的：
- 底板 pn 结:S 和 B 组成的,一般为<span style="background:#affad1">突变类型</span>的
- 侧壁 pn 结:S 和 $P^+$沟道阻挡层,<span style="background:#affad1">阻挡层</span>的掺杂浓度通常⼤于衬底的掺杂，于是形成了每单位⾯积较⼤的电容。侧壁结⼀般都是缓变的，梯度系数从0.33⾄0.5不等
因为这些都是<span style="background:#affad1">⼩信号电容</span>，所以我们通常把它们线性化并采⽤类似式(3.10)中那样的平均电容。
> [!info] 沟道阻挡层
> 在p型硅衬底上通过热氧化等[平面工艺](https://baike.baidu.com/item/%E5%B9%B3%E9%9D%A2%E5%B7%A5%E8%89%BA?fromModule=lemma_inlink)来制作器件和电路时，往往由于SiO2薄膜中存在有正电荷（Na离子沾污等所致），使得p型硅衬底表面上出现n型寄生沟道而造成短路；就在p型硅衬底的器件有源区以外的表面上注入硼离子（剂量约为1013/cm2），形成一层较高掺杂浓度的p型层，这样p型层就称为沟道阻止层。

![[support/img/Pasted image 20231107094433.png|500]]
![[support/img/Pasted image 20231107105329.png|400]]

##### (4)器件电容模型
整个 MOS 的电容可以表达为:(按照产生的电极分类)
$$\begin{array}{c}{C_{GS}=C_{GCS}+C_{GSO};\quad}&{C_{GD}=C_{GCD}+C_{GDO};\quad}&{C_{GB}=C_{GCB}}\\{C_{SB}=C_{Sdiff};\quad}&{C_{DB}=C_{Ddiff}}\\\end{array}$$

![[support/img/Pasted image 20231107105521.png|300]]
如果按照种类来划分的话,就看刚刚的那三种
##### (5)电阻
一个CMOS电路的性能可能进一步受另一组寄生元件的影响，这就是与漏区和源区相串联的电阻，如图3.35（a）所示。当晶体管的尺寸缩小时这一影响变得更为显著，因为尺寸缩小使结变浅，接触孔变小。漏(源）区的电阻可以表示为:$$R_{S,D}=\frac{L_{S,D}}{W}R_{\square}+R_{C}$$
其中, $R_c$是接触电阻,$W$是晶体管的宽度,而$L_{S,D}$是源或漏区的长度,见图3.35(b)。
$R_{\square}$是漏-源扩散区每⽅块的薄层电阻，它的范围为$20-100\Omega/\square$。 注意，材料的⽅块电阻是⼀个常数，它与⽅块的尺⼨⽆关。
![[support/img/Pasted image 20231107110052.png]]
#### 4.实际的 MOS 管二阶效应
#👁
##### (1)阈值变化
详细看课本,意思就是: 阈值电压变成与L、⽐和$V_{DS}$有关。
##### (2)热载流⼦效应
短沟道器件的阈值电压除了与设计间会有偏差之外，它也往往会**随时间漂移**。这是由于热 载流⼦效应的结果.
##### (3)CMOS 闩锁效应
MOS工艺会包含许多内在的双极型(BJT)管。它们在CMOS工艺中特别会引起麻烦，因为同时存在的阱和衬底会形成寄生的**n-p-n-p**结构。这些类似于*闸流管*的器件一旦激发即会导致$V_{DD}$和$V_{SS}$线短路，这通常会破坏芯片，或至少会使系统无法工作而只能断电后重新启动。

如下图所示:n-p-n-p结构是由 NMOS 的源、p衬底、n阱和由 PMOS 的源所形成。<u>当两个双极型管中的⼀个变为正向偏置时（例如由流 过阱或衬底的电流所引起），它提供了另⼀个双极型管的基极电流。这⼀正反馈使电流增加直⾄该电路失效或烧坏。</u>

![[support/img/Pasted image 20231107123036.png]]
因此,为了避免闩锁效应,应该使得电阻$R_{nwell}$和$R_{psubs}$最小。这可以通过提供很多阱和村底的接触并把它们放在 NMOS/PMOS 器件的源端接线附近来实现。传送大电流的器件(如在I/O驱动器中的晶体管)应当在周围有保护环(guard ring)。这些放置在晶体管周围的环形阱/衬底接触可以进一步减小电阻，从而减小寄生双极型管的增益。闩锁效应在早期的 CMOS 工艺中特别严重。近年来工艺上的创新和设计技术的改进已经几乎消除了闩锁的危险。
#### 5.MOS管的 SPICE 模型
#👁
短沟 MOS 晶体管特性的复杂性以及它的许多寄生效应已促使开发了许多模型，它们针对不同的精度和计算效率。一般来说，比较精确也意味着比较复杂，并因此增加了运行时间。在本节中简短地讨论比较常用的 MOSFET 模型的特点并介绍如何在电路说明中例举一个 MOS 晶体管。

课本上的3.4 工艺偏差; 3.5 综述: 工艺尺寸缩小; 3.6 小结
## 贰---互连线模型
随着深亚微⽶半导体⼯艺的出现,它们已开始⽀配数字集成电路⼀些相关的特性指标，如速度、能耗和可靠性。
这可以⽤⼀个简单的例⼦做最好的说明,⼀个总线⽹络中的每条导线把⼀个(或几个）发送器连⾄⼀组接收器。每条导线是由⼀系列具有不同长度和⼏何尺⼨的导线段构成的。假设所有的导线段都在同一互连层上实现，并且通过一层绝缘材料与硅衬底隔离及相互间隔离（注意现实情况比这更复杂）。右边是电路图,左边是加粗部分的实际视图. 
![[support/img/Pasted image 20231107125512.png|inLL|+grid|a|400]]![[support/img/Pasted image 20231107125431.png|+grid]]
### (1)集总模型Lumped Model
一条导线的电路奇生参数是沿的长度分布的，因此不能把它集总在一点上。然而当只有一个奇生元件占支配地位时，当在这些寄生元件之间的相互作用很小时或者当只考虑电路特性的一个方面时，把各个不同的(寄生元件）部分集总成单个的电路元件常常是很有用的。这一步骤的优点是寄生效应因此可以用**常微分方程**来描述。正如我们在后面将要看到的，描述一个分布元件需要偏微分方程。  
<u>只要导线的电阻部分很小并且开关频率在低至中间的范围内</u>，那么就可以很合理地只考虑该导线的电容部分，并把分布的电容集总为单个电容，如图4.11 所示。注意在这一模型中导线仍表现为一个等势区，因而导线本身并不引人任何延时。对于**性能的唯一影响是由电容对于驱动门的负载效应引起的**。这一电容集总的模型很简单但很有效，因此常常选用该模型来分析数宇集成电路中的大多数互连线。  
三种分析方法:
1. 多电阻,多电容,因此使用一组常微分方程
2. SPICE 模拟
3. Elmore 延时(70 年代的方法,比较准确)
![[support/img/Pasted image 20231107130310.png]]
#### A电阻电容网络---RC树
##### a特点:
1. 一个输入节点
2. 电容都在节点和地之间
3. 无电阻回路(因此叫树结构)
![[support/img/Pasted image 20231107130704.png|300]]

##### b参数定义:
- **路径电阻**$R_{ii}$: 源节点 s 与电路的任何节点 i 之间存在唯一的电阻路径，路径的总电阻称为路径电阻，如:$R_{44}\mathbf{=}R_1\mathbf{+}R_3\mathbf{+}R_4$
- **共享路径电阻**$R_{ik}$: 源节点 s 与电路的一个节点 i 和另一个节点 k 的这两条路径的共享电阻$R_{ik}=\sum R_j\Rightarrow(R_j\in[path(s\rightarrow i)\cap path(s\rightarrow k)])$
	<font color="#ff0000">例如:</font>$\color{red}{R_{i4}}\color{red}{=}R_1\color{red}{+}R_3,\color{red}{R_{i2}}\color{red}{=}R_1$
##### c时间常数计算
假设在 t=0 的时候加一个阶跃输入,则节点 i 的 Elmore 延时为:$$\tau_{Di}=\sum_{k=1}^NC_kR_{ik}$$
- 例子,上图的 i 点:$$\tau_{Di}=R_1C_1+R_1C_2+(R_1+R_3)C_3+(R_1+R_3)C_4+(R_1+R_3+R_i)C_i$$
- 注意:这个只是时间常数,还得 'x0.69'
#### B电阻电容网络---RC链
是 RC 树的特殊情形,没有分支了,因此其**共享路径电阻=路径电阻**
![[support/img/Pasted image 20231107132128.png]]
节点 N:$$\tau_{DN}=C_1R_1+C_2(R_1+R_2)+\cdots+C_N{\left(R_1+R_2+\cdots+R_N\right)}$$
节点 i:$$\tau_{Di}=C_{1}R_{1}+C_{2}(R_{1}+R_{2})+\cdots+\begin{aligned}(C_i+C_{i+1}+\cdots+C_N)(R_1+R_2+\cdots+R_i)\end{aligned}$$
- <font color="#ff0000">注意!!</font>这里的$\tau_{Di}$和$\tau_{i}$是有区别的,详见课本  
- 例子:长度为 L 的导线分割成长度相等的 N 段，每段长度为 L / N, 单位长度导线的电阻和电容分别为 r 和 c，每段的电阻和电容分别为 rL / N 和 cL / N
  利用Elmore公式，计算导线的时间常数:  $$\tau_{DN}=\left(\frac LN\right)^2\left(rc+2rc+\cdots+Nrc\right)=L^2(rc)\frac{N\left(N+1\right)}{2N^2}=RC\frac{N+1}{2N}$$
  其中R=rL和C=cL是导线的集总电阻和电容
  结论:
	- 当 N 很大的时候, 代入以上式子得到$\tau_{DN}=\frac{RC}2=\frac{rcL^2}2$, 集总 RC 链趋向于分布式 rc 线, 导线的时间常数是长度 L 的二次函数
	- 分布rc线(**N=无穷**)的时间常数是按集总 RC 模型(**N=1**)预测的时间常数的一半

### (2)分布模型
![[support/img/Pasted image 20231107134939.png#center|分布线的电路符号|100]]
![[support/img/Pasted image 20231107135614.png|400]]
电路中节点i处的电压可以通过求解以下⼀组偏微分⽅程来确定：$$c\Delta L\frac{\partial V_i}{\partial t}=\frac{(V_{i+1}-V_{i})+(V_{i-1}-V_{i})}{r\Delta L}$$
对于$\boldsymbol{\Delta}L\to0$, 以上方程就变成了扩散方程:$$rc\frac{\partial V}{\partial t}=\frac{\partial V}{\partial x^2}$$
其中, V是导线上⼀个特定点的电压，x是该点和信号源之问的距离。  
这个⽅程不存在收敛解，但可以推导出以下的近似表达式$$\left.V_{out}(t)=\left\{\begin{matrix}2\mathrm{erfc}\left(\sqrt{\frac{RC}{4t}}\right)&&t\ll RC\\\\1.0-1.366e^{-2.5359\frac{t}{RC}}+0.366\mathrm{e}^{-9.4641\frac{t}{RC}}&&t\gg RC\end{matrix}\right.\right.$$
这些公式很难⽤来进⾏通常的电路分析。然⽽我们已知分布式⼼线可以⽤**集总的 RC梯形⽹络**
来近似，后者可以很容易地⽤在计算机辅助分析中。
![[support/img/Pasted image 20231107140313.png|400]]


# L03: Hspice 的使用
# L04: Lab1
# L05~L06: CMOS 反相器
## 一、引言
### 1.CMOS 反相器和版图
#### (1)基本版图
![[support/img/Pasted image 20231107142127.png|380]]
**知识点**:
1. 在模拟之中,有特殊需要的版图,需要优化的才手工画,数字电路之中一般是在 IP 的标准库直接进行 mapping(映射)
2. D 和 S 在做完,使用之后才定下来
3. 区分长度 L,宽度 W 到底是哪个方向?长度一般就是沟道的长度,宽度是沿着纸面往里延伸
4. 金属的作用?金属一般是通过打孔,进行赋予电压和电路连线的
5. 注意这个 SDDS

![[support/img/Pasted image 20231107143257.png#center|侧切视图|380]]
> [!question] 怎么看懂这个版图?
> 还有怎么侧切这个图里边没有 N well 啊

**棍棒图(stick diagram)**: 只显示拓扑结构,但是没有维度![[support/img/Pasted image 20231107142713.png#center|棍棒图|200]]

#### (2)两个 CMOS 反相器相连的版图
![[support/img/Pasted image 20231107142808.png|380]]
**知识点:**
1. 注意用 metal 吧 1.out 和 2.in 连接起来了
2. 为了工艺制造上的方便, 两个 P well 连在一起了
3. 两个共享电源和地线,**高度是一样的**,因此可以拼在一起,因此节省了空间
4. 注意,在实际的大规模的版图之中, 都是背靠背的,也就是 VDD - GND - VDD -GND 这样进行相连的
> [!question] 单元之间的空隙, filler, ic 设计与方法提到过
> 
#### (3)补充知识
![[support/img/Pasted image 20231107164028.png#center|设计者和 fab 的文件交互流程|400]]
##### A 设计规则
**Design Rule:**
1. 设计者与工艺工程师之间的接口
2. 制造mask 的指南
3. 最基本的要素:最小线宽(线间距)
###### a 层内规则
![[support/img/Pasted image 20231107143959.png|+grid]]![[support/img/Pasted image 20231107163347.png|+grid]]
**知识点:**
1. 找图中的 0 or 6的意思就是要么合在一起,要么至少是 6
2. 0or6 和 9 的区别就是就在于那个 different <span style="background:#affad1">potential</span> #question 
3. 对于这些层名称的解释详见[[Fishing/First_Sem_Master_1/数大/关键问题/版图|版图]]
4. 注意往里指的箭头和往外的箭头的区别
5. 右图指的是伸出来的必须要大于 3
###### b 层间规则
![[support/img/Pasted image 20231107163520.png|+grid]]![[support/img/Pasted image 20231107163543.png|+grid]]
**知识点:**
1. via 和 contact 的区别
2. 为什么有一些对孔的限制?
3. Substrate:衬底
##### B EDA工艺层视图
![[support/img/Pasted image 20231107143815.png|+grid]]![[support/img/Pasted image 20231107143918.png|+grid]]
**知识点:**
1. #question 和实际的工艺层不是一一对应的,由虚拟和过渡层

##### C DRC
![[support/img/Pasted image 20231107164003.png|380]]


### 2.CMOS反相器的特性简介
#### (1)开关模型
##### A 静态特性
![[support/img/Pasted image 20231107194027.png|380]]

##### B 动态特性
![[support/img/Pasted image 20231107194043.png|380]]
#### (2)VTC
##### A 坐标变换法
**思路**:你看啊,P 和 N MOS连接在了一个电路之中, 因此如果要能把两者的特性曲线通过坐标变换之后放在同一个坐标系里边, 交点就是符合两个管子特性曲线的工作曲线.![[support/img/Pasted image 20231107195017.png#right|CMOS 结构|95]]
从右图中可以看到,上边 PMOS 的坐标曲线的 x 坐标应该是$V_{DSp}$, y 坐标应该是$I_{Dp}$, 参数坐标应该是$V_{GSp}$; 下边 NMOS 的坐标曲线的 x 坐标应该是$V_{DSn}$, y 坐标应该是$I_{Dn}$, 参数坐标应该是$V_{GSn}$. 使用以下的坐标变换:$$I_{Dp}=-I_{Dn},V_{GSp}=V_{in}-V_{DD},\quad V_{DSp}=V_{out}-V_{DD}$$
依据以上的坐标变换, 就能够得到以下的图像
![[support/img/Pasted image 20231107195731.png|500]]
这样, 我们就把 PMOS 的的横纵坐标变成了以上图最右边的样子, 一看这不就是 NMOS 的横纵和参数坐标吗?这样,把这两个图画在一起就有了:![[support/img/Pasted image 20231107200002.png|400]]
以上这个图中, 参数坐标对应一样的(条件一样)的交点就是 VTC.  但是注意,要把参数坐标变成 VTC 中的横坐标.
##### B VTC曲线的分析
###### a 五个点的定性分析
首先应该在上边的交点图上,多画一对曲线. 这样就有了五个点,否则只有四个点.   
*第一个点*:此时 PMOS 是知道 D/S 之中一个为 VDD, G 的电压为 0, 因此要么是饱和区, 要么是线性区. 
	#question<span style="background:#affad1"> 如何去确定到底是线性还是饱和?</span>
	感觉还是要解方程啊. 从结果来看的话,此时的输出是 VDD, 因此$V_{DSp}$几乎是 0. 所以说这个条件就是线性的条件. 由于栅压是 0,所以说NMOS肯定是截止,  无论是和 D 还是和 S 比. <span style="background:#affad1">就是不知道如何从数学上推出来,不知道悬空如何解释?</span>  
*第二个点*:这个点对应图中斜率是-1 的点, 从交点的的图上来看, 对应的红线(NMOS)一定是饱和的, 但是对于蓝线, 在图上来看, 不一定是线性还是饱和. <span style="background:#affad1">在计算上如何确定这种不确定性?</span>  
*第三个点*:这个点一定是俩都饱和,数学上还是不知道怎么办.  
之后的第四个和第五个同理  
![[support/img/Pasted image 20231107200332.png|400]]
###### a 几个关键点的定义
![[support/img/Pasted image 20231107211306.png|+grid]]![[support/img/Pasted image 20231107211322.png|+grid]]
- $V_M$ 开关阈值: ${V}_{{M}}=f({V}_{{M}})$
- $V_{OH}$ 高输出电平:$\mathrm{V}_{\mathrm{OH}}=f(\mathrm{V}_{\mathrm{OL}})$
- $V_{OL}$ 低输出电平:$\mathrm{V}_{\mathrm{OL}}=f(\mathrm{V}_{\mathrm{OH}})$
- $V_{IH}$ :斜率等于-1时的,较低的那个输入电压
- $V_{IL}$ :斜率等于-1时的,较高的那个输入电压
###### b 噪声容限 Noise Margins
**串连的反相器**门的噪声定义  
<u>噪声容限越大，逻辑门的抗干扰能力就越强</u>![[support/img/Pasted image 20231107211621.png#right|噪声容限示意|0150]]
高噪声容限 Noise margin high:
$$NM_{H}=V_{OH}-V_{IH}$$
低噪声容限 Noise margin low:
$$NM_{L}=V_{IL}-V_{OL}$$

##### C 再生性 Regenerative Property
当第一级的输入偏离额定电平时，后面各级能否逐渐收敛回到正确的电平？如果可以的话,就是具有再生性.其中的一个例子对应 PPT 上的是课本 P15 页的例子,明白 v0,v1,v2 的含义
下图是一个反相器的链,第一级的输出是 v1,输入是 v0; 第二级的输出是 v2,输入是 v1.<span style="background:#affad1">如何放在同一个坐标之中啊</span>,我能理解 y 轴是一个,但我不能理解 x 轴啊,除非你说第一个和第三个是等效的

![[support/img/Pasted image 20231107230229.png|300]]

放在一个图之中就有了下图:
![[support/img/Pasted image 20231107230503.png|400]]
其中是否具有再生性的关键就是:<font color="#ff0000">过渡区增益的绝对值大于1</font>  
#question 什么是过渡区?
#### (3)其他特性
##### A 扇入和扇出Fan-out/in
参考:![[support/img/Pasted image 20231107233033.png#right|扇入和扇出|300]]
1. 教材的 P17.   
2. https://zhuanlan.zhihu.com/p/620111029
3. [https://blog.csdn.net/gtatcs/article/details/8922192](https://blog.csdn.net/gtatcs/article/details/8922192)
定义:
1. 扇出：输出端连接（同类）门的个数
2. 扇入: 输入端的个数
**知识点:**
1. 增加扇出,会影响逻辑输出电平
2. 使得**负载门**的*输入电阻*尽可能大(也就是*输入电流*尽可能小), 并保持**驱动门**的*输出电阻*较小(即负载电流对输出电压的影响),可以使得 1. 中的影响最小.
3. 增加扇出, 会使驱动门的动态性能变差,因此很多单元定义了最大的扇出数
4. 扇入增大也会使动态和静态性能变差
##### B 理想门的特性

![[support/img/Pasted image 20231107233204.png|400]]
#### (4)早期的反相器--NMOS 反相器
在 20 世界70 年代的时候使用 NMOS 反相器,因为 <span style="background:#affad1">NMOS 的迁移率比较高</span>
![[support/img/Pasted image 20231107233442.png|400]]
**知识点:**
1. 为什么是两个 nmos 的形式?
   - 首先看上边的这个 nmos,它的 D 和 G 是连在一起的(<span style="background:#affad1">咋区分的这里的 DS</span>), 而且都是最高的电平,因此要么是截止要么是饱和导通. 能够截止的原因是因为寄希望于能够存在某个$V_{in}$能够使得上边 nmos 的 GS 电压小于阈值电压. 
   - 下面的 nmos 也是上边是 D 下边是 S.  
	a. <font color="#ff0000">如果 in 是高电平</font>,因此下面的管子一定可以导通. <span style="background:#affad1">导通的时候相当于啥玩意啊,那个电阻咋算的?</span>.
		假设上边是截止, 那么根据分压肯定就是 out=0, 但是out 等于 0 的时候上边也是饱和导通,因此矛盾.所以上边不可能截止
		假设上边是饱和导通,那么分压不是很好说.从结果来看,既然是反相器对吧,那么就要输出低电平, 而上边又不可能截止,因此只能让上边的电阻(饱和导通)大于下边的电阻. 还是从结果来看,既然输出的是低电平,那么下边一定是线性电阻区.问题就是线性电阻区和饱和导通的 MOS 管的电阻怎么算了---详见--[[Fishing/First_Sem_Master_1/数大/第三章 器件|第三章 器件]]. 先从定性上来分析的话, 饱和导通时电压增大,电流不变,所以就是电阻增大. *所以等效电阻的话,饱和区大于线性区.* 因此,上边的分压大,所以输出的$V_{out}$就是一个接近于 0 的分压, 但是不为 0   
	b. <font color="#ff0000">如果 in 是低电平</font>, 下边的管子一定是截止的,只要上边不是也截止就能保证输出的是高电平. 所以我们假设输出的是高电平, 上边的也确实是截止了. 但这里不对, 上边截止是要求 out 一定要比 4.3V 还要大, 如果是小于 4.3V 的话, 那么上边依旧是饱和导通, 电阻小于截止区的电阻, 但是不为 0, 这样的话确实也可以输出一个高电平. 实际的情况是后一种.<span style="background:#affad1">前一种为啥不行?(不能双截止分压?)</span>
2. 综上所述, 上边的一直是处于饱和导通状态,相当于是一个电阻

#### (5)CMOS 的特点
1. CMOS输出高电平和低电平分别为VDD和GND。信号电压摆幅等于电源电压，噪声容限很大。
![[support/img/Pasted image 20231108000920.png|350]]
2. 无比逻辑
	1. 逻辑电平与器件尺寸无关，晶体管可采用最小尺寸。
	2. 电路翻转时，不会因为尺寸设计的原因而出现翻转错误。
3. 具有低输出阻抗, 稳态时在输出和VDD 或 GND 之间总存在一条具有有限电阻 的通路，对噪声和干扰不敏感。
![[support/img/Pasted image 20231108001110.png|400]]
4. 输入电阻极高
	1. 不消耗直流输入电流
	2. 理论上可以驱动无限多个门。
	![[support/img/Pasted image 20231108001253.png|400]]
5. 不考虑泄漏功耗的情况下，没有静态功耗
	![[support/img/Pasted image 20231108001324.png|400]]
	![[support/img/Pasted image 20231108001431.png|400]]
	虽然说那里有一个一下子的下降,但是还是回去了,<span style="background:#affad1">为啥</span>
## 二、静态特性分析
### 1.开关阈值的求解
#### (1)$V_M$的求解
$V_M$的特点是输入等于输出,在图中来看就是,NMOS 和 PMOS 的 ${V_{GS}}{=V_{DS}}$, 因此不是饱和导通就是截止. 稍微动脑子就知道肯定不是截止, <font color="#ff0000">所以两个管子都是饱和导通</font>.   
假设电源电压足够大,处于**速度饱和**,即:$$V_{DSAT}<V_{M}-V_{T}\tag1$$
由电路的串联关系可得:$$I_{Dn}=-I_{Dp}\tag2$$
 联立式(1)(2),并忽略沟长调调制效应,可得:$$k_nV_{DSATn}\left(V_M-V_{Tn}-\frac{V_{DSATn}}2\right)=-k_pV_{DSATp}\left(V_M-V_{DD}-V_{Tp}-\frac{V_{DSATp}}2\right)\tag3$$
 注:此处利用了手工分析模型(再谈速度饱和的那个式子), 把$V_{GT}$稍微改一下就行. 解得: $$V_M=\frac{\left(V_{Tn}+\frac{V_{DSATn}}2\right)+r\left(V_{DD}+V_{Tp}+\frac{V_{DSATp}}2\right)}{1+r}\tag4$$
 其中, $$r=\frac{k_pV_{DSATp}}{k_nV_{DSATn}}=\frac{\upsilon_{satp}W_p}{\upsilon_{satn}W_n}\tag5$$
#### (2)结果分析
 1. *假设*$V_{DD}>>V_{Tn}或说(|V_{Tp}|)$且$V_{DD}>>V_{DSATn}或说(|V_{DSATp}|)$, 则可以得到:$$\begin{aligned}V_M=&\frac{\left(V_{Tn}+\frac{V_{DSATn}}2\right)+r\left(V_{DD}+V_{Tp}+\frac{V_{DSATp}}2\right)}{1+r}=\frac{rV_{DD}}{1+r}=\frac{V_{DD}}{1+1/r}\end{aligned}\tag6$$
      如果令$V_M\boldsymbol{=}V_{DD}/2$,也就是阈值电压是电源的一半,和(6)联立就得到$$r=1$$
      带入 r 的定义,也就是式子(6),把 k 拆开为$k=k^{'}W/L'$可得到$$\left(W/L\right)_p/\left(W/L\right)_n=\left(V_{DSATn}k^{^{\prime}}_n\right)/\left(V_{DSATp}k^{^{\prime}}_p\right)$$
      这个式子就表明了pmos 和 nmos 的尺寸之比.
 2. *若没有这个假设*,则通过式(3)可以直接得到:$$\frac{\left(\boldsymbol{W}/\boldsymbol{L}\right)_p}{\left(\boldsymbol{W}/\boldsymbol{L}\right)_n}=\frac{k^{^{\prime}}{}_nV_{DSATn}\left(V_M-V_{Tn}-V_{DSATn}/2\right)}{k^{^{\prime}}{}_pV_{DSATp}\left(V_{DD}-V_M+V_{Tp}+V_{DSATp}/2\right)}$$
 3. 从图中了解一下n,p尺寸之比对 阈值电压$V_M$的影响
    比较直观的分析时式(5)中的第二个等号后面的东西加上简化假设之后的式(6).  
    r 不看饱和速度的话, r 可以直接当做 p/n 的尺寸比, r 变大, 分母变小, 阈值电压变大.也就是 p 管子相对于 n 管子尺寸越大, 阈值电压越大. 
    - 在直观上进行分析, 上边的尺寸变大, 电阻变小, 都饱和导通, 上边分压变小, 所以阈值电压变大
    - 在实际计算之中 P122 页有一个例子, .25微米之下, 尺寸比大概 3.5 的时候, 阈值电压为 Vdd 的一半
    - <span style="background:#affad1">Vm 时电压摆幅一半的时候, 高低电平的噪声余量相同, 噪声容限最大</span>
     ![[support/img/Pasted image 20231108111617.png|500]]
#### (3)根据$V_M$的反相器分类
如果输入信号的<span style="background:#affad1">零值</span>受到噪声的干扰,输出也会受到很大的干扰,如果采用不对称的阈值,则可以去掉这一个干扰.
- 改变阈值并不容易, 看上边的半对数坐标
- 尤其在 <span style="background:#affad1">VDD/晶体管阈值 比较小的时候</span>, 更难改变
![[support/img/Pasted image 20231108111902.png|550]]
#### (4 )长沟器件的开关阈值
对长沟器件或电源电压较低情形，不会发生速度饱和,即$V_M-V_T{<}V_{DSAT}$, 因此得到$$\begin{aligned}V_{_M}=\frac{V_{_{Tn}}+r(V_{_{DD}}+V_{_{Tp}})}{1+r}\quad\quad\text{其中}\quad r=\sqrt{\frac{-k_p}{k_n}}\end{aligned}$$

### 2.噪声容限的求解
既然已知噪声容限的公式是:$$\begin{aligned}NM_H&=V_{OH}-V_{IH}\\NM_L&=V_{IL}-V_{OL}\end{aligned}$$
那么求取问题的关键就是知道 k=-1 的时候的电压,也就是$V_{IH}$和$V_{IL}$. 
#### (1)求解方法一
1. 第一步
	**假设N管和P管的状态**, 并列出电流相等的方程$$I_{Dn}(V_{in},V_{out})=-I_{Dp}(V_{in},V_{out})\tag7$$
2. 第二步
	对式(7)两边求导得到$$\begin{aligned}&\frac{\partial I_{Dn}(V_{in},V_{out})}{\partial V_{in}}=-\frac{\partial I_{Dp}(V_{in},V_{out})}{\partial V_{in}}\\&\frac{\partial V_{out}}{\partial V_{in}}=-1\end{aligned}\tag8$$
3. 第三步
	结果代入第一步,验证假设是否成立.最后求得噪声容限
#### (2)求解方法二
使用分段线性近似的方法![[support/img/Pasted image 20231111004723.png#right|求解方法二|150]]
1. 求解$V_M$
2. 求解$V_M$处的增益 g
3. 求解$V_{IH}$和$V_{IL}$
	$$\begin{aligned}V_{IH}&=V_M+\frac{V_M}{|g|}\\V_{IL}&=V_M-\frac{V_{DD}-V_M}{|g|}\end{aligned}\tag9$$
4. 求得噪声容限
🌰
- 求解增益 g(<font color="#ff0000">VTC 曲线的斜率啊</font>)
   设NMOS和PMOS都工作在速度饱和区，考虑沟道长度调制效应
	$$\begin{aligned}
   &k_nV_{DSATn}\Bigg(V_{in}-V_{Tn}-\frac{V_{DSATn}}2\Bigg)\Bigg(1+\lambda_nV_{out}\Bigg)+ k_pV_{DSATp}\Bigg(V_{in}-V_{DD}-V_{Tp}-\frac{V_{DSATp}}2\Bigg)\Bigg(1+\lambda_pV_{out}-\lambda_pV_{DD}\Bigg)=0
   \end{aligned}$$
	$$\frac{dV_{out}}{dV_{in}}=-\frac{k_nV_{DSATn}(1+\lambda_nV_{out})+k_pV_{DSATp}(1+\lambda_pV_{out}-\lambda_pV_{DD})}{\lambda_nk_nV_{DSATn}(V_{in}-V_{Tn}-V_{DSATn}/2)+\lambda_pk_pV_{DSATp}(V_{in}-V_{DD}-V_{Tp}-V_{DSATp}/2)}\tag{10}$$

	忽略二次项,  并假设$V_{in}{=}V_{M}$. 得到
	$$g\thickapprox-\frac1{{I_D(V_M})}\frac{k_nV_{DSATn}+k_pV_{DSATp}}{\lambda_n-\lambda_p}=-\frac{1+r}{(V_M-V_{Tn}-V_{DSATn}/2)(\lambda_n-\lambda_p)}\tag{11}$$
   **实例**
   ![[support/img/Pasted image 20231111005647.png|+grid]]![[support/img/Pasted image 20231111092155.png|+grid]]
   <span style="background:#affad1">较大的误差发生于此处</span>,意思是分段线性那一步导致的误差要大于上边式10->11那一步的<span style="background:#affad1">忽略二次项和有关</span>近似假设的结果.见课本P124
### 3.稳定性的进一步分析
#### (1)器件参数的变化
1. 存![[support/img/Pasted image 20231111095310.png#right|V_T corner|200]]在哪些影响器件**数值参数**的外在条件或者工艺误差呢?
	- *温度*在一个很大的范围内变化
	- 制造过程中的偏离
2. 好在 CMOS反相器 的**直流特性**对上述的变化十分不敏感. 这里就分"好的/坏的"PMOS 和"好的/坏的"NMOS 的组合. 好坏通常用 FAST 还是 SLOW 的区别.
	- Good: $t_{ox}$小, L 小, W 大, $V_T$小
	- Bad: $t_{ox}$大, L 大, W 小, $V_T$大
		- $t_{ox}$是栅氧层的厚度
		- #question <span style="background:#affad1">这里如何知道好坏对应的这四个参数到底是大还是小</span>, *我感觉是好就是响应快对应 fast*, 是不是这样??
3. 造成的影响
	- 造成了曲线的平移,注意**平移的方向,会判断**
	- 对于形状没有什么影响
	- 对于输出的高低电平没什么影响
#### (2)电源电压
#question <span style="background:#affad1">器件尺寸的连续缩小导致电源电压也也降低, 但是期间的阈值电压(区分阈值电压和开关阈值)却没有什么变化,这对器件的工作稳定性有什么影响呢?</span>
- 电压降低的时候还能否正常工作?
	1. 首先观看式(11)
	   对于固定的晶体管尺⼨⽐r, $V_M$正比于电源电压$V_{DD}$可以发现反相器的增益 g 随着电源电压的降低而增大.
	2. 反相器在电源电压在接近*晶体管阈值*的时候仍能够很好地工作, 在图中电源电压都是 0.5V 了, 只比阈值电压高 100mV 的时候, 还能够很好地工作.并且此时的 VTC 曲线很好,过渡区的宽度只是电源电压的10%. 而⽽电源电压为2.5 V时, 它加⼤到17%. 
- 电源电压的降低是不是存在一个限制?
	1. 不加区分地降低电源电压虽然对减少能耗有正⾯影响，但它绝对会使*⻔的延时加⼤*。
	2. 一旦电源电压和本征电压(阈值电压)变得可⽐拟，*直流特性对器件参数*(如晶体管國值）的变化就变得越来越*敏感*。
	3. 降低电源电压意味着*减⼩信号摆幅*。虽然这通常可以帮助<span style="background:#affad1">减少系统的内部噪声(如由串扰引起的噪声）</span>，但它也使设计*对并不减⼩的外部噪声源更加敏感*。
- 如果进一步降低$V_{DD}$会如何?
	1. 在$V_{DD}$降低至200mV左右，还能保持反相器的特性(**200mV 怎么开启啊**)不开启, 但是看下一条中的亚阈值电流
	2. 亚阈值电流使得反相器可以在高电平和低电平间翻转，提供了足够的增益得到较理想的VTC曲线
	3. 开关电流值很低决定了反相器⼯作得⾮常慢，但这也许在某些应⽤（例如⼿表）中可以接受
	4. 当接近 100 mv 时，我们开始看到门的特性变得很差。$V_{OL}$和$V_{OH}$不再等于电源的两个电平，并且过渡区的增益接近1。为了能达到足够的增益以用于数字电路，必须使电源至少等于第3章所说的热电势的两倍. 此当低于这⼀电压时，热噪声也会成为⼀个问题⽽可能引起不可靠的⼯作。我们把这⼀关系表⽰为$$V_{DDmin}>2\cdots4\frac{kT}{q}$$
	   这个式子写出了电源电压的最小值, 大概是 2~4 倍的热电势. 上式代表了电源电压降低的实际限制。这意味着使 CMOS 反相器工作在 100mV 以下的唯一方法是降低环境温度，从而减小热电势. 
	   ![[support/img/Pasted image 20231114185900.png|500]]
### 4.小结
![[support/img/Pasted image 20231114192317.png|400]]
## 三、动态特性分析
### 1.负载电容分析与计算
CMOS反相器的传播延时由P管和N管对负载电容充放电时间决定,设所有的电容⼀起集总成⼀个单个的电容$C_L$,其处于$V_{out}$和 GND 之间,其简化模型如下![[support/img/Pasted image 20231114192737.png|200]]
一对串联的反相器的电路图和详细的寄生电容分布情况如下.
![[support/img/Pasted image 20231114192800.png|450]]
假设输入$V_{in}$由⼀个上升和下降时间均为零的理想电压源所驱动. 只考虑连⾄输出节点上的电容时，$C_L$分成以下几个部分  
#👁 这里 PPT上没有,只有课本上有
### 2.传播延时分析
#### (1)开关模型
把 CMOS![[support/img/Pasted image 20231114193711.png#right|开关模型|100]] 等效成一个开关, 右图是1->0 的时候的等效电路. 由此模型可以得出$$t_p=\frac{t_{pHL}+t_{pLH}}2=0.69{\left(\frac{R_{eqn}C_{L,HL}+R_{eqp}C_{L,LH}}2\right)}\approx0.69C_L{\left(\frac{R_{eqn}+R_{eqp}}2\right)}\tag{12}$$
其中已经假设$C_{H,HL}=C_{L,LH}=C_L$, 接下来计算等效电阻:$$\begin{aligned}
\boldsymbol{R}_{eq}& \begin{aligned}=\frac1{V_{DD}/2}\int_{V_{DD}/2}^{V_{DD}}\frac V{I_{DSAT}\left(1+\lambda V\right)}dV\end{aligned}  \\
&\approx\frac34\frac{V_{DD}}{I_{DSAT}}\left(1-\frac79\lambda V_{DD}\right)\approx\frac34\frac{V_{DD}}{I_{DSAT}}\left(1-\frac56\lambda V_{DD}\right)
\end{aligned}\tag{13}$$
其中$I_{DSATn}$为: $$I_{DSAT}=k^{\prime}\frac WL{\left((V_{DD}-V_T)V_{DSAT}-\frac{{V_{DSAT}}^2}2\right)}\tag{14}$$
忽略式(13)之中的括号内的部分,计算$t_{pHL}$,有$$\begin{gathered}
t_{pHL} =0.69C_LR_{eqn}\overset{\quad}{\operatorname*{=}}0.69\times\frac34\frac{C_LV_{DD}}{I_{DSATn}}=0.52\times\frac{C_LV_{DD}}{I_{DSATn}} \\
=0.52\times\frac{C_LV_{DD}}{\left(W/L\right)_nk^{^{\prime}}{}_nV_{DSATn}\left(V_{DD}-V_{Tn}-V_{DSATn}/2\right)} 
\end{gathered}\tag{15}$$
若假设$V_{DD}>>V_{Tn}+V_{DSATn}/2$, 则有$$t_{_{pHL}}=0.52\times\frac{C_{L}}{(W/L)_{n}k^{^{\prime}}{_n}V_{_{DSATn}}}\tag{16}$$
**得到结论**:
- 在以上近似前提下,高$V_{DD}$下，传播延时与电源电压基本无关
- 高$V_{DD}$下，<span style="background:#affad1">由于沟长调制</span>，提高$V_{DD}$会使传播延时略有减小
![[support/img/Pasted image 20231114195558.png|450]]
![[support/img/Pasted image 20231114195730.png|450]]
上图的$R_{eq}$与$t_p$和 V_DD 的关系基本是一样的, 因为负载电容假设是一个定值.   
#question <span style="background:#affad1">不太懂上图中为啥电源电压很高的时候, 调制了沟道, 所以才有那个变化?</span>
### 3.性能设计优化
观察公式$$t_{_{pHL}}=\frac{0.52\times C_LV_{_{DD}}}{\left(W/L\right)_nk^{^{\prime}}_nV_{_{DSATn}}\left(V_{_{DD}}-V_{_{Tn}}-V_{_{DSATn}}/2\right)}$$
可以发现为了减少延时, 有以下的方法  
1. 减小负载电容
   - 自身的扩散电容（漏区面积尽可能小）
   - 连线电容
   - 扇出电容  
	前两个和版图设计有关
   其中前两个可以通过**合理的版图设计**进行减小, 后一个没啥办法
2. 加大晶体管尺寸(W/L)
   - 优点：增加了驱动能力（增大充放电电流，降低导通电阻） 
   - 缺点：扩散电容增大，从而使C增大 (Self-loading) 
   - 缺点：栅电容增加，使前一级的扇出电容增加
3. 提高电源电压$V_{DD}$
	- $V_{DD}$增加到一定程度, 对延时优化效果不明显
	- 功耗增加
	- 出于安全的考虑, $V_{DD}$有严格的上限
#### (1)第一种情况
求解单个对称反相器 （${t_{pHL}}{=t_{pLH}}$）驱动固定负载$C_{ex}$时的延时$t_p$与反相器尺寸放大系数S的关系：![[support/img/Pasted image 20231114210225.png|300]]
该反相器的**负载电容**$C_L$分为两个部分:$$C_L=C_{int}+C_{ext}$$
其中, $C_{int}$为*本征电容*（自载电容）, 包括漏扩散电容和栅漏覆盖电容;   
	 $C_{ex}$为外部*负载电容*, 包括扇出电容和连线电容  
因此**传播延时**为:$$\begin{gathered}
_p=0.69R_{eq}(C_{int}+C_{ext})=0.69R_{eq}C_{int}(1+C_{ext}/C_{int}) \\
=t_{p0}(1+C_{ext}/C_{int}) 
\end{gathered}$$
其中, $t_{p0}$为*本征延时*, 即外部负载电容为 0 的时候的延时
<u>分析以上的式子</u>, 主要考虑面积 S 的影响  
以最小尺寸反相器作为参考，考虑一个**尺寸系数为 S** 的反相器的延时. 设最小尺寸的本征电容为$C_{iref}$,导通电阻为$R_{ref}$. 尺寸系数S的意思为<u>P管和N管的附/L相对于最小尺寸反相器均放大了S倍</u>, 则其本征电容为$S\cdot C_{iref}$, 本征电阻为$R_{ref}/S$. 因此这样计算的话, 延时为:$$\begin{aligned}t_p&=0.69(R_{ref}/S)(SC_{iref})(1+C_{ext}/\left(SC_{iref}\right))\\&=0.69R_{ref}C_{iref}(1+C_{ext}/\left(SC_{iref}\right))=t_{p0}(1+C_{ext}/\left(SC_{iref}\right))\end{aligned}$$
从以上的式子可以得到以下的结论: 
1. **本征延时与反相器尺寸无关**，而仅与工艺和版图相关。加大尺寸系数，晶体管的导通电阻减小，但是本征电容增大；
2. 当外部负载电容$C_{ex}$为零时，增加尺寸井不能减小延时。这是因为，驱动能力的提高被自身增加的电容负载抵消；
3. S越大，延时越小 (S无穷大，延时=本征延时）。当S相对${C_{ext}/C_{int}}$足够大时，进一步增加S，延时改善非常有限<font color="#ff0000">（自载效应）</font>，面积却会显著增加。
![[support/img/Pasted image 20231114211837.png|400]]
#### (2)第二种情况
如![[support/img/Pasted image 20231114233713.png#right|两级反相器|200]]右图，求解<u>一个反相器驱动另一个同样的反相器</u>时，设反相器P管的尺寸是N管的$\beta$倍，则第一个反相器的延时$t_p$与$\beta$的关系：  
*设*: 右图中P管的尺寸是N管的$\beta$倍, 即$${\beta=(W/L)_p/(W/L)_n}$$
*设*: 右图的N管电阻为$R_{eqn}$, 又设与该N管具有相同尺寸的P管的电阻为$R_{eqp}$. 则,右图中相对于N管放大了$\beta$倍的P管的电阻为$R_{eq}/\beta$.
*若要求*: 第一个反相器具有对称的上升时间和下降时间, 即$t_{pHL}=t_{pLH}$, 可以得到$$\beta{=}R_{eqp}/R_{eqn}$$
(解释一下以上的意思, 这个$R_{eq}$是相同尺寸的N和P管的等效电阻, 但是在图中是已经放大了的$\beta$倍的管子,所以要求等效电阻有这个关系)
*若要求*:第一个反相器有最小的延时, 首先计算第一个反相器的延时:  
(1)$C_L$的计算:$$\begin{aligned}
C_{L}& =(C_{dp1}+C_{dn1})+(C_{gp2}+C_{gn2})+C_{w}  \\
&=(\beta C_{dn1}+C_{dn1})+(\beta C_{gn2}+C_{gn2})+C_{w} \\
&=(1+\beta)(C_{dn1}+C_{gn2})+C_{W}
\end{aligned}$$
其中$C_{dp1}$和$C_{dn1}$是第一个反相器的NMOS的*漏扩散电容*, 而$C_{gp2}$和$C_{gn2}$为第二个反相器的栅电容, $C_w$为连线电容. 当PMOS器件为NMOS器件的的$\beta$倍的时候, 所有晶体管的电容也等比例的加大, 因此有了第一行到第二行的转化. 
(2)$R_{eq}$的计算: $$R_{eq}=\frac{(R_{eqn}+R_{eqp}/\beta)}2$$
(3)延时$t_p$的计算:$$t_p=0.69C_LR_{eq}=0.69[(1+\beta)(C_{dn1}+C_{gn2})+C_W]\frac{(R_{eqn}+R_{eqp}/\beta)}2$$
(4)求$\beta$等于什么值的时候, 能够有最小的延时:$$\frac{\partial t_p}{\partial\beta}=0\quad\Rightarrow\quad\beta=\sqrt{\frac{R_{eqp}}{R_{eqn}}(1+\frac{C_W}{C_{dn1}+C_{gn2}})}$$
若果有条件:$C_{dn1}+C_{gn2}>>C_{w}$, 则可以得到$$\beta=\sqrt{\frac{R_{eqp}}{R_{eqn}}}$$
这意味着当导线电容可以忽略时，$\beta$等于$\sqrt{\frac{R_{eqp}}{R_{eqn}}}$，这不同于在非串联情形时通常采用的比值r。如果导线电容占主导地位，那么应当采用较大的$\beta$值。这一分析令人奇怪的结果是, 当以对称性及<span style="background:#affad1">噪声容限</span>为代价时，较小的器件尺寸(因而较小的设计面积)得到了较快的设计。
![[support/img/Pasted image 20231115105013.png|400]]
#question <span style="background:#affad1">噪声容限?为啥1.9的平方不是2.4?上图中这个31K/13K是什么</span>
#### (3)第三种情况
**反相器链的设计**  
**适用的情景**: 驱动大负载, 能够是实际使用的一般简化形式  
**问题描述**: 如果给定负载电容$C_L$和第一个反相器的输入电容$C_{g1}$, 要求传输延时$t_p$
最小, 请问
1. 应该用多少级反相器进行驱动
2. 如何设计这些反相器的尺寸?
##### A 一些假设
*设*: 反相器的输入栅电容$C_g$与<span style="background:#affad1">本征输出电容</span>$C_{int}$之间的关系如下:$$C_{int}=\gamma C_{_g}$$
其中, $\gamma$是比例系数, 只与工艺有关, 对于大多数亚微米工艺$\gamma=1$
*因此*: 传播延时为$$t_p=t_{p0}\left(1+\frac{C_{ext}}{C_{int}}\right)=t_{p0}\left(1+\frac{C_{ext}}{\gamma C_{g}}\right)$$
其中, $t_{p0}$为本征延时(无外部负载), 与晶体管的尺寸无关
*设*: $C_{ext}=fC_g$, f为<font color="#ff0000">等效扇出</font>, 因此上式可以变为$$t_p=t_{p0}\Bigg(1+\frac{C_{ext}}{\gamma C_{g}}\Bigg)=t_{p0}\Bigg(1+\frac f\gamma\Bigg)$$
*结论*: 反相器的延时只取决于外部负载电容与输入电容间的比值f.
##### B 延时公式应用于反相器链
![[support/img/Pasted image 20231115111626.png|300]]
反相器链总延时: $$t_p=t_{p,1}+t_{p,2}+...+t_{p,N}\tag{15}$$
第j级反相器的延时为: $$t_{p,j}=t_{p0}\left(1+\frac{C_{g,j+1}}{\gamma C_{g,j}}\right)=t_{p0}(1+f_j/\gamma)\tag{16}$$
把式(16)带入(15)则有: $$\begin{aligned}t_p&=\sum_{j=1}^Nt_{p,j}=t_{p0}\sum_{j=1}^N\left(1+\frac{C_{g,j+1}}{\gamma C_{g,j}}\right)\end{aligned}\tag{17}$$
其中有, $C_{g,N+1}=C_L$
##### C 求每一级的f约束
==给定级数 N , 给定负载$C_L$和给定输入电容$C_{in}$的情况下,确定最优的尺寸比 f==  
式(17)中一共有N-1个未知数: $\boldsymbol{C_{g,2}}\sim\boldsymbol{C_{g,N}}$
求解方法: 求 N-1 个偏微分并令他们都等于0, 即$$\partial t_p/\partial C_{g,j}=0$$
可以得到$$C_{g,j+1}/C_{g,j}=C_{g,j}/C_{g,j-1}$$
上式的意思是, 每一级反相器的尺寸是与其相邻前后两个反相器尺寸的几何平均数, 即$$C_{g,j}=\sqrt{C_{g,j-1}C_{g,j+1}}$$
并且说明了两点
1. 每一级有相同的等效扇出f
2. <span style="background:#affad1">每一级有相同的延时</span>
若每一级具有相同的尺寸放大系数为 f, 则$$f^N=F=C_L/C_{g,1}$$
因此得到: $$f=\sqrt[N]{F}$$
带入式(17)得到延时为$$t_p=Nt_{p0}(1+\sqrt[N]{F}/\gamma)$$
<span style="background:#affad1">注意, 等效扇出变为等效放大系数, 如何变过去的</span>  
🌰![[support/img/Pasted image 20231115113028.png|+grid]]![[support/img/Pasted image 20231115113057.png|+grid]]

##### D 确定级数N和F的关系
==级数 N 未知的情况下，给定负载$C_L$和给定输入电容$C_{in}$的情况下, 并且规定各级的尺寸系数均为$f=\sqrt[N]{F}$求f的值最优级数 N==
<span style="background:#affad1">刚才那一个是, 给定了N, 求f为什么样子, 结果是给出了表达式以上f和F的表达式. 现在是说N又为止了, 但是还用了N已知时候的f和F的关系, 不理解. </span>应该有的解释是, f和F关系的得出不依赖于N, 因此这里可以接着用.但是这样话就不能算作两种独立的求解条件了.  
各级尺寸放大系数均为 f ，则最小延时为：$$t_p=Nt_{p0}(1+\frac{\sqrt[N]{F}}\gamma)\tag{18}$$
将$t_p$表示为F，f 和γ的函数：$$t_p=Nt_{p0}(1+\frac{\sqrt[N]{F}}\gamma)~=\frac{\ln F}{\ln f}t_{p0}(1+\frac f\gamma)~=\frac{\ln F}\gamma t_{p0}(\frac\gamma{\ln f}+\frac f{\ln f})\tag{19}$$
其中利用了$C_L=F\cdot C_{in}=f^NC_{in}$和$N=\frac{\ln F}{\ln f}$  
由于F是定值,这样就完全把$t_p$表达成了f的函数,因此对f求导$$\frac{\partial t_p}{\partial f}=\frac{\ln F}\gamma t_{p0}\cdot\frac{\ln f-1-\gamma/f}{\ln^2f}=0\tag{19}$$
得到了$$f=e^{\left(1+\gamma/f\right)}\tag{20}$$
这是一个超越方程,按照课本上的叙述主要有两个情况  
1. 只有一个**收敛解**,就是$\gamma=0$的时候,此时的意思是<font color="#ff0000">忽略自载,负载电容=扇出</font>,这样就有$N=\ln\left(F\right), f=e=2.718$,以指数的形式放大各级尺寸,并且因此称为**指数锥形.**  
2. 若包含自载,也就是$\gamma$不为0的时候,只能求**数值解**,如图所示. 
3. 对于$\gamma=1$的典型情形,$f_{opt}=3.6$. 而且下图画出了在$\gamma=1$时, 传播延时(归一化延时)和f(等效扇出)的关系.
![[support/img/Pasted image 20231121104258.png|400]]
<span style="background:#ff4d4f">f=4的最终选择问题</span>($\gamma=1$)
1. 主要看右边那个图, 在f=3.6的时候确实是最小的,但是啊,f加大一些不会明显地增大延时
2. f大还有一个好处就是能够减少反相器的级数和实现面积
3. f小延时增加
综上所述最有扇出为4.  
🌰
![[support/img/Pasted image 20231121104312.png|300]]
**总结**
![[support/img/Pasted image 20231121104329.png|+grid]]![[support/img/Pasted image 20231121104340.png|+grid]]
#### (4)信号斜率对于延时的影响
此前延时的推导基于两个假设：
1. 输入信号是突变的，即上升时间或下降时间为0
2. 两个晶体管不同时导通
实际的情况: 
1. 输入信号是缓变的，因为前级门的驱动是有限的
2. 两个静态管可能同时导通
##### A 为什么会影响延时?
实际上，输⼈信号是逐渐变化的，⽽且 PMOS 和 NMOS 管会暂时同时导通⼀段时间。这会影响所得到的充(放)电总电流，从⽽影响传播延时。

那为啥又会导致充电电流的变化呢, 因为有斜率, 所以说不一直是电源经过NMOS或者PMOS给电容充电,有的时候会直接从俩mos通过对地去了,所以不全是给负载电容充电了.
##### B 斜率导致的影响(反相器延时（高->低）与输入信号上升时间的关系)
斜率的这个时间表达为: <font color="#ff0000">输入信号上升时间或者下降时间</font>  
有关系: $$t_{_{p_{HL}}}=\sqrt{t_{_{pHL}}^2(step)+(\frac{t_{_{rise}}}2)^2}$$
参数解释:
- $t_{pHL}$就是修正之后的,带有斜率的信号的延时
- $t_{pHL}(step)$是阶跃信号(理想信号)输入的时候的延时
- $t_{rise}$是信号上升的时间,表达了斜率
因此有图:![[support/img/Pasted image 20231121110506.png|300]]
从上图可以看出当$t_{\mathrm{~rise}}>t_{pHL}$,近似线性关系. <u>从这个平方相加看出来的吧.</u>   
##### C 最终表达式
<span style="background:#affad1">因此</span>修正反相器的延时为: $$t^i_p=t^i_{step}+\eta t^{i-1}_{step}$$
参数定义: 
- ${t^i}_{p}$: 第i个反相器的传播延时
- ${t^i}_{step},{t^{i-1}}_{step}$: 第 i 个反相器及其前一级门的阶跃输入延时
- $\eta$: 经验常数, 典型值0.25
🌰  ![[support/img/Pasted image 20231121110826.png|400]]
![[support/img/Pasted image 20231121110810.png|400]]
**其他事项**: ![[support/img/Pasted image 20231121110910.png|400]]

### 4. 小结
- 负载电容的计算
	- 本征电容（本级的栅漏电容和漏级的扩散电容）
	- 外部负载电容（下一级的栅电容和引线电容）
- 性能设计优化
	- 反相器延时与负载的关系（第一种情况）
	- 反相器性能最优与上下对称设计（第二种情况）
	- 反相器链的设计（第三种情况）
		- 已知 F 和 N（第一种条件），求 f
		- 已知 F（第二种条件），求 f 和 N
	- 实际设计中要考虑输入信号斜率的影响
## 四、功耗分析和低功耗设计
CMOS反相器的功耗 P 由以下3部分构成：
1. **动态功耗**(Dynamic Power)$P_{dyn}$  
   对负载电容的充电和放电造成的功耗
2. **短路功耗**(Short Circuit Currents)$P_{dp}$  
   开关过程中电源和地之间瞬间的直流通路造成的功耗
3. 静态功耗(Static Power)$P_{stat}$  
   稳定输出高电平或低电平时的直流功耗，漏电流造成
因此总功耗为:$$\color{red}{P_{tot}=P_{dyn}+P_{dp}+P_{stat}}$$
### 1. 动态功耗
#### (1)一次高低翻转
输![[support/img/Pasted image 20231121111501.png#right|等效电路|150]]出从低至高翻转期间的等效电路（忽略输入波形的下降时间） 
- 从电源之中取得的能量: 
$$\begin{gathered}
\boldsymbol{E}_{\boldsymbol{VDD}} =\int_0^\infty i_{VDD}(t)V_{DD}dt=V_{DD}\int_0^\infty C_L\frac{dV_{out}}{dt}dt \\
=C_LV_{DD}\int_0^{V_{DD}}dV_{out}=C_L{V_{DD}}^2 
\end{gathered}$$
- 储存在电容上的能量: $$\begin{aligned}E_C&=\int_0^\infty i_{VDD}(t)V_{out}dt=\int_0^\infty C_L\frac{dV_{out}}{dt}V_{out}dt\\&=C_L\int_0^{V_{DD}}V_{out}dV_{out}=\frac{C_LV_{DD}^2}2\end{aligned}$$
#### (2)时钟周期内
每次从0-->1从电源获取的能量为: $C_LV_{DD}^2$  
因此N个时钟周期的翻转消耗的电源能量为:$$E_N=C_LV_{DD}^2\times n(N)$$
  参数解释:  n(N)为N个时钟周期内0-->1的翻转次数
动态功耗就是的整体时间上的平均功耗,因此就有了$$P_{dyn}=\lim_{N->\infty}\frac{E_N}{N\times T_{clk}}=[\lim_{N->\infty}\frac{n(N)}N]\times{C_L}{V_{DD}}^2f_{clk}={P_{0->1}}{C_L}{V_{DD}}^2f_{clk}\tag{20}$$
  参数解释:$P_{0->1}$输入变化导致输出发生0->1变化的概率,又称为**翻转活动因子**
假设等效电容$$C_{EFF}=P_{0\to1}\times C_L$$
因此式(20)可以变为$$P_{dyn}=C_{EFF}{V_{DD}}^2f_{clk}$$
<font color="#ff0000">动态功耗与晶体管尺寸无关（负载电容确定的情况下）</font>  
🌰  
![[support/img/Pasted image 20231121112803.png|400]]
#### (3)优化
使得右图,能![[support/img/Pasted image 20231121113103.png#right|电路图|200]]量最小的晶体管尺寸设计, 目标如下:  
1. 待设计的参数：尺寸系数f和电源电压$V_{DD}$
2. 在满足$t_{p}\leq t_{pref}$的<span style="background:#affad1">前提</span>下,使得电路的**能耗**最小  
	其中, $y_{pref}$是f=1且$V_{DD}=V_{ref}$的参考电路的传播延时$t_{_{pHL}}=\frac{0.52\times C_{_L}V_{_{DD}}}{\left(W/L\right)_nk^{^{\prime}}{_n}V_{_{DSATn}\left(V_{_{DD}}-V_{_{Tn}}-V_{_{DSATn}}/2\right)}}$
##### A 性能约束
右图电路的延时如下(两个相加嘛)$$t_p=t_{p0}\left(\left(1+\frac f\gamma\right)+\left(1+\frac F{f\gamma}\right)\right)\tag{21}$$
  参数解释: $F=C_{ext}/C_{gl}$, 总等效栅出
而其中$$t_{_{p0}}\propto\frac{V_{_{DD}}}{V_{_{DD}}-V_{_{TE}}}\tag{22}$$$$V_{TE}=V_{T}+V_{DSAT}/2$$
由于要求$t_{p}\leq t_{pref}$, 因此求一下他俩的比值,<font color="#ff0000">最终的结果是求出</font>$\color{red}V_{DD}(f)$$$\frac{t_p}{t_{pref}}=\frac{t_{p0}}{t_{p0ref}}\frac{\left(2+f+\frac Ff\right)}{\left(3+F\right)}=\frac{V_{DD}}{V_{ref}}\frac{V_{ref}-V_{TE}}{V_{DD}-V_{TE}}\frac{\left(2+f+\frac Ff\right)}{\left(3+F\right)}\leq 1\tag{23}$$
其中第一个等号利用了上面的式(21), 其中$\gamma=f=1$.第二个等号利用了式(22).从上式可以总结出两点:
1. $V_{DD}$上升, $t_p$下降. 
2. $f=F^{0.5}$的时候, $t_p$最小.  
如果令式(23)等于1的话,则可求出一个电源电压$V_{DD}$和F, f的关系<font color="#ff0000">.(因为功耗是需要电源电压的呀)</font>, 因此有了下图![[support/img/Pasted image 20231121175540.png|300]]
怎么理解这个图呢? 首先这个图是在延时为最大允许值的条件下求出来的, 纵轴为电源电压$V_{DD}$. 在某一个确定的F之下, 电源电压都是先降后升的, 为啥呢, *因为f在到达*$F^{0.5}$之前, f的上升会导致延时的下降(观察式子23的第一个等号), 因此可以把这些延时的下降牺牲掉,换做电压的下降(电源电压下降, 延时上升.), 这样小号的**功率就下降**了. 在到达$F^{0.5}$之后, f的上升会导致延时的上升, 因此电源电压就不得上升来挽回降低的速度了.这时候, **能耗也就上升**了.  
##### B 计算能量功耗
$$\begin{aligned}E&=V_{DD}^2[\underline{C_{g1}+\gamma C_{g1}}+\underline{fC_{g1}+\eta CC_{g1}}+\underline{FC_{g1}}]\\&=V_{DD}^2C_{g1}[(1+\gamma)(1+f)+F]\end{aligned}$$
第一个下划线: 第一级的输入栅电容和本征输出电容; 第二个下划线: 第二级的输入栅电容和本征输出电容; 第三个下划线: 负载电容. 神奇的是都可以和第一级的输入栅电容建立关系, 因此就有了第二行.  
这样, 和参考两级反相器($\gamma=f=1$)的功耗相比,有了$$\frac E{E_{ref}}=\left(\frac{V_{DD}(f)}{V_{ref}}\right)^2\left(\frac{2+2f+F}{\color{red}{\boxed{4+F}}}\right)$$
太难解了, 画图方法不错,因此![[support/img/Pasted image 20231121182936.png|400]]
##### C 结论
1. 改变器件尺寸并降低电源电压是减少逻辑电路能耗的有效方法。
2. 在最优值之外过多地加大晶体管的尺寸会付出较大的能量代价。
	- 在基于标准单元的半定制设计当中，常常放大晶体管的尺寸以 满足驱动一定范围的负载的性能要求，因此能耗往往比较高。
3. 考虑能量时的最优尺寸系数小于考虑性能时的最优尺寸系数。例如，当F = 20时，$f_{opt}(\text{能量})=3.53,\text{ 而}f_{opt}(\text{性能})=20^{0.5}-4.47。$

### 2.短路功耗
- **定义**: 开关过程中电源和地之间瞬 间的直流通路造成的功耗(因为有斜率,也就是输入波形上升/下降时间不为0 ， NMOS和PMOS管同时导通，VDD 和 GND之间在短时间内出现直流通路)
#### (1)计算短路功耗
![[support/img/Pasted image 20231121183256.png|300]]
开关周期消耗的能量:$$V_{_{DD}}\frac{I_{_{peak}}t_{_{sc}}}2+V_{_{DD}}\frac{I_{_{peak}}t_{_{sc}}}2=t_{sc}V_{DD}{I_{peak}}$$
其中: $$t_{sc}=\frac{V_{DD}-2V_{T}}{V_{DD}}t_{s}\approx\frac{V_{DD}-2V_T}{V_{DD}}\times\frac{t_{r(f)}}{0.8}$$
平均功耗是这个周期内的能耗除以这个周期的时间, 就是<span style="background:#affad1">乘频率</span>$$P_{dp}=t_{sc}V_{DD}I_{peak}f=C_{sc}V_{DD}{}^{2}f$$
其中$C_{sc}=t_{sc}I_{peak}/V_{DD}$   
此外, $I_{peak}$由器件的<font color="#ff0000">饱和电流</font>决定, 因此<font color="#ff0000">直接正比于晶体管的尺寸</font>. 此外峰值电流也与<font color="#ff0000">输入和输出的上升/下降时间之比</font>密切相关.见(2)即可.
#### (2)负载对短路电流的影响
![[support/img/Pasted image 20231121183730.png|400]]
⾸先假设负载电容很⼤，所以输出的下降时间明显⼤于输⼈的上升时间.在这些情况下,输入在输出开始改变之前就已经通过了过渡区。由于在这⼀时期 PMOS 器件的源-漏电压近似为0，因此该器件甚⾄还没有传导任何电流就断开了。这种情况 下短路电流接近于零。现在考虑相反的情况，就是输出电容⾮常⼩，因此输出的下降时间明品⼩于输⼈的上升时间，PMOS 器件的源-漏电压在翻转期间的⼤部分时间内等于$V_{DD}$.从⽽引起了最⼤的短路电流(等于PMOS 的饱和电流)。这显然 代表了最坏情况的条件。

![[support/img/Pasted image 20231121210804.png|400]]

这⼀分析的结论是：使**输出**的上升/下降时间⼤于**输⼈**的上升/下降时间可以使短路功耗减到最⼩。<font color="#ff0000">但输出的上升/下降时间太⼤会降低电路的速度并在扇出门中引起短路电流。</font>
这个例⼦很好地说明了只顾局部优化⽽不管全局是如何会引起不良后果的。
#### (3)小总结
- 对![[support/img/Pasted image 20231121221941.png#right|短路功耗和斜率比值关系|150]]于一个给定尺寸的反相器: 
	- 负载电容**太小**时，功耗主要来自**短路电流**
	- 对非常**大的负载**电容，功耗来自**充/放电负载电容**。
	- 如果是输入和输出的上升/下降时间**相等**，大部分功耗来自**动态功耗**，只有小部分(< 10%)来自短路功耗。
- 电源电压降低时，短路电流的影响减小。若$V_{DD}<V_{tn}+|V_{tp}|$，则可以消除短路电流。
- 从全局优化的角度，应该要求**输入和输出信号的上升/下降时间匹配**来使短路功耗达到最小。
### 3.静态功耗
⼀![[support/img/Pasted image 20231121222142.png#right|漏电流|200]]个电路的静态(或称稳态）功耗可⽤下列关系来表示：$$P_{stat}=I_{stat}\cdot V_{DD}$$
	其中, $I_{stat}$是没有开关活动存在时在电源两条轨线之间流动的电流。
理想情况是 CMOS 反相器的静态电流为零，因为PMOS 和 NMOS 器件在稳态⼯作状况下决不会同时导通。可惜的是，总会有**泄漏电流**流过位于晶体管**源(或漏）与衬底之间的反相偏置的⼆极管结**,
- **漏电电流**与*温度*有关, *亚阈值电流*是漏电电流的主要来源
#### (1)pn结漏电
![[support/img/Pasted image 20231121222212.png|500]]
#### (2)亚阈值漏电
**亚阈值电流**是$V_{GS}$小于阈值电压的时候, 也会有一个阈值电流.  
阈值电压越是接近0v，则在$V_{GS}=0V$时的泄漏电流越⼤，因⽽静态功耗也就越⼤。为了抵消这⼀效应，器件的阈值电压⼀般应当保持⾜够⾼。标准⼯艺的特征值$V_T$V从未⼩于 0.5~0.6 V，有时甚⾄还相当⼤(~0.75 V)。  
随亚微⽶⼯艺尺⼨的缩⼩，同时出现了电源电压降低，因⽽这⼀⽅法受到挑战.我们在前⾯已经总结过(见图 5.17)，<span style="background:#affad1">降低电源电压同时保持阈值电压不变会造成性能的严重损失</span>，特别是$V_{DD}$接近二倍$V_T$的时候.  
为了解决这一问题,可以降低这⼀器件的阈值电压。它意味着由降低电源电压造成的性能损失滅⼩。可惜的是，阈值电压的最低值是由 所允许的亚阈值漏电流的数量所决定的，如图5.35 所⽰。因此阈值电压的选择代表了在性能和<font color="#ff0000">静态功耗之问的权衡取舍</font>。

如下图, $V_{GS}$越大, $V_T$ 越小, $I_D$越大. 
![[support/img/Pasted image 20231121222704.png|400]]
**工艺尺寸缩小 => 电源电压降低（动态功耗下降） => 阈值降低（静态功耗增加）**
![[support/img/Pasted image 20231121231108.png|400]]
#### 4. 综合考虑
总功耗为:$$P_{tot}=P_{dyn}+P_{dp}+P_{stat}=(C_{L}V_{DD}^2+V_{DD}I_{peak}t_s)f_{0->1}+V_{DD}I_{leak}$$
功耗延时积（PDP): $$PDP=P_{a\nu}t_p=\frac{C_L{V_{DD}}^2}{2t_p}t_p=\frac{C_L{V_{DD}}^2}2$$
  1. 衡量切换一个门所需要的的能量
  2. 又被称为电路的优值
  3. 每操作的能耗
  4. 其中假设了门以最快的速度切换
能量延时积（EDP):$$EDP=PDP\times t_p=P_{a\nu}t_p^2=\frac{C_L{V_{DD}}^2}2t_p$$
  1. 同时考虑性能和能耗的衡量
  2. 又被称为电路的品质因子
## 五、总结
![[support/img/Pasted image 20231121231533.png|450]]
# L07~L08: CMOS 组合逻辑门
## 一、引言
## 二、互补CMOS
### 1. 互补CMOS逻辑门的构造规则
#### (1)PUN 和  PDN
- PUN: 上拉网络, 每当(输入决定的)逻辑门的输出意味着逻辑 1 时, 其将提供一条在输出和$V_{DD}$之间的通路.
- PDN: 下拉网路, 每当(输入决定的)逻辑门的输出意味着逻辑 1 时, 其将提供一条在输出和$V_{SS}$之间的通路.
PUN 和 PDN 是以相互排斥的方式构成的: 在稳定状态下, 两个网络中有且只有一个导通. 也就是说, <span style="background:#affad1">稳定状态时的输出节点总是一个低阻节点. </span>(这里的意思是不是, VDD 或者 GND 直通 $V_{out}$)
![[support/img/Pasted image 20231113001145.png|+grid]]![[support/img/Pasted image 20231113001204.png|+grid]]
#### (2)设计逻辑
因为上拉网络只是 PMOS, 下拉网络只是 NMOS. 
##### A 或非
###### a NMOS
![[support/img/Pasted image 20231113130733.png#right|NMOS与非|100]]由于这是 NMOS ,因此用作下拉, 就是把Y下拉为 0,这只在 A=1,B=1 的情况下才成立,因此就有$$\mathbf{Y}=\mathbf{\overline{AB}=0}$$
###### b PMOS
![[support/img/Pasted image 20231113131242.png#right|PMOS 与非|100]]PMOS 因此是上拉网络, 所以有输入为 1, 当 A=0, B=0 的时候有 Y=1, 因此就是$$\mathbf{Y}=\mathbf{\overline{AB}=0}$$

##### B 与非
思路同上![[support/img/Pasted image 20231113141857.png|300]]
#### (3)构造简单的门
通过上面的就知道了能够通过上边的 PMOS 和下边的 NMOS 分别构造一个逻辑, 上下就能构成一个完整的逻辑了. 这里的关键就是, 上边只负责 1, 下边只负责 0. ![[support/img/Pasted image 20231113142210.png|200]]
**一些经验规则**:
1. 晶体管看作是由其栅端信号控制的开关。
2. PDN用NMOS器件，PUN用PMOS器件。
3. 推导构造逻辑功能的规则：NMOS串联对应与（AND）功能，NMOS并联对应或（OR）功能。
4. PUN和PDN是对偶网络。构造CMOS门，可用串并联器件的组合实现其中一个网络（如PDN），然后根据对偶性原理得到另一个网络。
5. 互补门自然求反功能。单级只能实现NAND，NOR和XNOR等，非反相布尔函数需要额外的反相器。
6. 实现N输入的逻辑门需要晶体管数目为2N。
🌰![[support/img/Pasted image 20231113142354.png|300]]
对于上边的这个例子来说, 其实可以根据上下两个网络分别写出两个式子来, 他们是等价的, 但是是分别而直观的. 
### 2.互补CMOS门的静态特性
- 高噪声容限
	- 标称电平部分
    标称高低电平就是电源和 GND
	- $V_{IH}和V_{IL}$部分
	  与输入信号的情况有关
- 没有静态功耗
  稳定的时候没有 VDD 到 GND 的通路
- VTC
  与输入信号的情况有关
#### (1)输入图案的影响
与反相器不一样, PUN 和 PDN 的**电阻**是输入的图案, 因此不同的输入组合有不同的 **VTC**, 从而有不同的**噪声容限**. 
#👁 #notebook

### 3.互补CMOS门的传播延时
#### (1)一阶分析
在这里, 输入模式也会对延时有不同的影响. 首先我们先进行一阶分析, 也就是忽略内部节点的电容.   
以下面的 NAND 为例子, 从输出的变化进行考虑延时大小:
1. **输出低到高转换**
	1. 两输入都变低: ${0.69\times(R_p/2)\times C_L}$
	2. 一个输入变低: ${0.69\times R_p\times C_L}$
	这里的*关键*就是: 有三种情况都能使输出从 0 变成 1, 但是他们对应的上拉(充电的)电路的走过的电阻是不同的, 假设哈这里的 PMOS 都是一样的, 那么明显以这种输出的变化为例子的话, 仅有一个输入变化的话会导致有更大的延时
2. **输出高到低转换**
   两输入都变高: $0.69\times(2R_n)\times C_L$
#### (2)二阶分析
![[support/img/Pasted image 20231113184315.png#right|NAND门|130]]
分析时应当考虑的点:
1. 输入使输出上升还是下降？
2. 内部节点的电容如何充放电？
3. 串联管子中哪个网值电压较高？
以右边的 NAND 门为例子来看的话, 还是按照输出的变化进行分类的话, 可以导致其输出从 1 到 0 的输入端的变化组合形式一共有三种(当然了, 另一个也有三种, 但一共有16 种).    
通过以上的三种情况考虑延时
##### A 输出从 0 到 1
(1) **A=B=1->0**：2个P管同时充电，同时不用对2个N管间的<span style="background:#affad1">寄生电容</span>充电，所以最快。
(2) **A=1，B＝1->0**：关断B所驱动的N管相对（3）中关断A所驱动的N管困难，同时要对2个N管之间的寄生电容充电，所以最慢。
(3) **A=1->0，B=1**：关断A所驱动的N管相对（2）中关断B所驱动的N管容易，同时不用对2个N管之间寄生电容充电，所以速度居中。
#notebook #👁 
##### B 输出从 1 到 0
(1)**A=0->1，B=1**：虽然开启A所驱动N管相对(2)中开启B所驱动的 N管困难，但是2个N管之间寄生电容上的电荷早就泄放掉了，所以速度最快。
(2)**A=1，B=0->1**：虽然开启B所驱动的N管相对(1)中开启A所驱动的N管容易，但是2个N管之间寄生电容上的电荷直到B所驱动的N管开启才泄放，因此速度居中。
(3)**A=B=0->1**：A所驱动的N管的电阻相对(2)中A所驱动的N管电阻大，因此2个串联的N管的总电阻相对(2)中的大，放电慢，所以速度最慢。![[support/img/Pasted image 20231113214116.png#center|延时与输入模式的关系|400]]
### 4.互补CMOS门的尺寸设计
目标设计**对称响应**的电路结构  
*(1)对称响应的概念*  
对称就是上升和下降, 响应就是响应时间 t. 因此就是$t_{pLH}$和$t_{pHL}$相等(为什么 PPT 上写的$R_P=R_N$)  
这里的意思应该是, 反相器的 NMOS 和 PMOS 的等效电阻相同的时候, 才有反相器的上升和下降延时是相同的.  
那么问题来了
	1. 为什么反相器的$R_P=R_N$的时候才有$t_{pLH}=t_{pHL}$. 
	2. NMOS 和 PMOS 的*长宽比的比值*大概是什么值的时候才有$R_P=R_N$, 这个比值是 1 吗?
*(2)参照反相器*  
意思就是, 使**逻辑组合器件的延时大概等于这个反相器的延时**. 此外, 这个反相器的bb是给出的, 反正这个 bb 能够使得$t_{pLH}=t_{pHL}$, 这样也都等于$t_p$了. 
*(3)例子*  
更好的例子是课本上的例子, 不仅给出了 W/L 的比值, 还给了单位. 要是只给出了比值的话,我们无法得到具体的两个值.   
直接进行截图:![[support/img/Pasted image 20231113221227.png]]
再给一个课件上的例子:![[support/img/Pasted image 20231113221511.png|400]]
### 5.互补CMOS门扇入对延时的影响
之前考虑的时候,都忽略了节点内部的电容. 但是在扇入很大的时候, 不能这么考虑. 于是使用下面的 4 输入 NAND 门进行分析
![[support/img/Pasted image 20231114102020.png|400]]
(1)$t_{pHL}$
	每一个电容都要通过<span style="background:#affad1">电阻放电</span>(为啥对应下面的加号), 因此通过 **Elmore 模型**就有$$\begin{aligned}
t_{pHL}=& 0.69[{R_1}C_1  \\
&{+(R_1+R_2)C_2} \\
&+(R_1+R_2+R_3)C_3 \\
&+(R_1+R_2+R_3+R_4)C_L]
\end{aligned}$$
如果NMOS 的尺寸都是一样的,则有$$t_{pHL}=0.69R\left(C_1+2C_2+3C_3+4C_L\right)$$
<font color="#ff0000">注意:</font>$\color{red}M_1$<font color="#ff0000">电阻出现在所有的项之中, 所以在优化延时的时候显得尤为重要. </font>因此在设计的的时候M1～M4的尺寸应该递减（电阻递增）.  
仔细观察上边的式子,其实就是 1+2+...+n, 因此是 n 的二次方的函数.  
(2)$t_{pLH}$  
使连至输出节点的PMOS 器件数呈线性增加，我们可以预见门的由低至高的延时将随扇人数线性增加-因为虽然电容线性增加，但上拉电阻保持不变。
$$t_{pLH}=R(C_1+C_2+C_3+C_4+C_L)$$
(3)$t_{p}$  
![[support/img/Pasted image 20231114103228.png|400]]
### 6.互补CMOS组合逻辑链的性能优化
**目的:** 确定逻辑链路径中各级的尺寸以优化路径速度  
**一般来说**: 
- 一条逻辑路径的*原始输入电容*往往是确定的；
- 这条逻辑路径的*末端必须驱动的电容负载*也是确定的；
**问题:**  
- 如何确定逻辑链路径中的尺寸来达到最快？
- 能否把反相器链的情况推广一下?
#### (1)考虑逻辑门对称设计的情况
![[support/img/Pasted image 20231114103631.png#right|对称的 NAND 与参考 CMOS|150]]考虑输出下降的情景，反相器同与非门具有相同的<font color="#ff0000">驱动能力（相同的输出电阻）</font>
##### A 原始延时表达式
###### a 反相器的延时原始表达式
$$\begin{aligned}
tp(INV)& =t_{P0}\left(1+{\frac{C_{L}}{C_{\mathrm{int}}}}\right) \\&=t_{P0}\left(1+{\frac{C_{L}/C_{gin}}{C_{\mathrm{int}}/C_{gin}}}\right)  \\

&\text{=} =t_{p0}\left(1+{\frac{f}{\gamma}}\right) 
\end{aligned}$$
参数(1):$\gamma=\frac{C_{\mathrm{int}}}{C_{gin}}$
参数(2):$f=\frac{C_{\mathrm{L}}}{C_{in}}$
###### b 逻辑门的延时
$$\begin{aligned}
t_{P}(ND2)& =t_{p0(ND2)}\left(1+\frac{C_{L}}{C_{\mathrm{int}(ND2)}}\right)=  \\
& =k\bullet t_{P0}\left(1+\frac{C_{L}}{kC_{\mathrm{int}}}\right)=t_{p0}\left(k+\frac{C_{L}}{C_{\mathrm{int}}}\right)=  \\
&=t_{p0}\Bigg(k+\frac{C_{in(ND2)}}{C_{gin}}\bullet\frac{C_{L}/C_{in(ND2)}}{C_{int}/C_{gin}}\Bigg)= \\
&=t_{p0}\Bigg(k+g_{ND2}\frac{f_{ND2}}{\gamma}\Bigg)= \\
&=t_{p0}\Bigg({P_{ND2}}+g_{ND2}\frac{f_{ND2}}{\gamma}\Bigg)
\end{aligned}$$
参数(3)(4)定义如下, 并且假设$k\equiv P_{ND2}$
$$\begin{array}{l}{t_{p0(ND2)}=k\bullet{t_{P0}}}\\\\{C_{\mathrm{int}(ND2)}=k\bullet C_{\mathrm{int}}}\\\end{array}$$$$g=\frac{C_{in(ND2)}}{C_{gin}}$$

###### c 综上所述
- 反相器的延时为:  $t_{p}=t_{p0}\left(1+\frac{f}{\gamma}\right)$
- 一般逻辑门的延时为:  $t_{p}=t_{p0}\Bigg(p_{i}+\frac{g_{i}\cdot f_{i}}{\gamma}\Bigg)$
又因为 $\gamma=\frac{C_{\mathrm{int}}}{C_{gin}}$一般取值是 1, 因此有:
**反相器:** $$t_{p}=t_{p0}\cdot(1+{f})$$**逻辑门:**$$t_{p}=t_{p0}\cdot(p_{i}+{g_{i}\cdot f_{i}})$$
以上就得到了<font color="#ff0000">延时的原始表达式</font>
##### B 参数的定义和意义
- **p  归一化本征延时**  
	- $p=k=t_{P0(ND2)}/t_{P0}=C_{int(ND2)}/C_{int}$  
	- 该复合门和简单反相器的本征延时的⽐(即⽆负载)
	- *本征延时与门的类型有关，但它与门的尺寸（晶体管宽度的加倍）无关.* 
	- ![[support/img/Pasted image 20231114110558.png|500]]
- **g 逻辑努力**
	- $g=\frac{C_{in(ND2)}}{C_{gin}}$  
	- 逻辑努力 (Logical effort）是对于给定的负载，一个门的输入电容和与它具有相同输出电流的反相器的输入电容的比。  
	- *本征延时与门的类型有关，但它与门的尺寸（晶体管宽度的加倍）无关.* 
	- ![[support/img/Pasted image 20231114110625.png|500]]
- **f 等效扇出 电气努力**
	- $f=\frac{C_{\mathrm{L}}}{C_{in}}$  
	- 该门的外部负载电容和输⼈电容之间的⽐.  
	- “电气努力”（即等效扇出）与（负载电容/栅输入电容）的比值有关
	**其他知识点:**
1. 反相器在所有的静态 CMOS 门中具有最小的逻辑努力和本征延时。
2. 逻辑努力 (Logical effort）随门的复杂度而加大。
3. ![[support/img/Pasted image 20231114111256.png|200]]

##### C 链式的简化和求解
###### a 进一步简化(h 和 d)
因![[support/img/Pasted image 20231114111132.png#right|d和h的定义|300]]为扇出和逻辑努⼒是以类似的⽅式来影响延时的, 因此将两者乘积做定义:$$h=fg$$
因此复合门的延时变为:
$$t_p=t_{p0}\cdot(p+h)$$
再做定义: $$d=p+h$$
则有最简化的某一级的复合门延时:$$t_p=t_{p0}\cdot d$$
###### b 路径分支对于 f 的影响
![[support/img/Pasted image 20231114111612.png|300]]  
对于上图公式的解释, 还要计算分支上<span style="background:#affad1">所有的负载电容</span>对于对于我这一级$C_{gin}$  
###### b 复合门链的公式
某一条线路上的所有的逻辑门的延时求和, 则有:$$Delay=\sum\limits_{i=1}^{N}\bigl(p_{i}+g_{i}\cdot f_{i}\bigr)$$因此目的就是使得以上式子的取值最小, <span style="background:#affad1">通过求偏导数</span>得到: *当每⼀级应当具有相同的门努⼒*的时候, 有着最小的总延时, 即:$$f_{1}g_{1}=f_{2}g_{2}=\cdots=f_{N}g_{N}$$
沿电路中一条路径的总逻辑努力可以通过把这条路径上所有门的逻辑努力相乘求得，由此得到了路**径逻辑努力( path logical effort) G**:$$G=\prod_{1}^Ng_i$$
我们也可以定义**路径的有效扇出(或电气努力)P**，它建立了路径中最后一级负载电容与第一级输人电容之间的关系：$$F=\frac{C_{L}}{C_{g1}}$$
为了把戶和各个门的等效扇出联系起来，必须引人另一个系数来考虑电路内部的逻辑扇出。当一个节点的输出上有扇出时，总驱动电流中的一部分沿我们正在分析的路径流动，而有些则离开这条路径。我们把给定路径上一个**逻辑门的分支努力(branching eftort)b**定义为:$$b=\frac{C_{\mathrm{on-path}}+C_{\mathrm{off-path}}}{C_{\mathrm{on-path}}}$$
式中，$C_{on-path}$是该门沿我们正在分析的路径上的负载电容，⽽$C_{off-path}$是离开这条路径的连线上的电容。
如果路径没有分⽀(如在逻辑门链中的情形），则分⽀努⼒为1.   
**路径分⽀努⼒**(**path branching effort**)定义为该路径上每⼀级分⽀努⼒的积，即$$B=\prod_{1}^{N}b_{i}$$
于是<u>路径电⽓努⼒</u>现在就可以与<u>各级的电⽓努⼒</u>和<u>分⽀努⼒</u>联系起来：$$F=\prod_{1}^{N}\frac{f_{i}}{b_{i}}=\frac{\prod f_{i}}{B}$$
最后，可以确定**总路径努⼒H**:$$H=\prod_{1}^{N}h_{i}=\prod_{1}^{N}g_{i}f_{i}=GFB$$

### 7.互补CMOS门的功耗优化
## 三、动态 CMOS 设计
## 四、总结
# L09: 时序逻辑电路设计